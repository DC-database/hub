/* IBA Messages - standalone (1.0.10) */
/* Theme system: light/dark toggle (stored in localStorage). */

/* Light (default) */
:root{
  --bg:#f3f6fb;
  --card:#ffffff;
  --line:rgba(15,23,42,.12);
  --soft:rgba(15,23,42,.04);
  --soft2:rgba(15,23,42,.06);
  --text:#0f172a;
  --muted:rgba(15,23,42,.65);
  --danger:#b42318;
  --accent:#2563eb;

  --shadow:0 26px 110px rgba(15,23,42,.18);
  --glass:rgba(255,255,255,.72);
  --bubble-me:rgba(37,99,235,.12);
  --bubble-other:rgba(15,23,42,.06);

  /* Set dynamically from JS so content never hides behind the fixed topbar */
  --topbar-h:64px;
}

/* Dark */
html[data-theme="dark"]{
  --bg:#070b14;
  --card:#0b1222;
  --line:rgba(148,163,184,.14);
  --soft:rgba(148,163,184,.08);
  --soft2:rgba(148,163,184,.12);
  --text:#e5e7eb;
  --muted:rgba(226,232,240,.70);
  --danger:#ff6b6b;
  --accent:#60a5fa;

  --shadow:0 26px 120px rgba(0,0,0,.55);
  --glass:rgba(11,18,34,.62);
  --bubble-me:rgba(96,165,250,.16);
  --bubble-other:rgba(148,163,184,.10);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
  background:
    radial-gradient(1200px 800px at 20% 0%, rgba(37,99,235,.14), transparent 60%),
    radial-gradient(900px 700px at 80% 10%, rgba(249,115,22,.10), transparent 55%),
    radial-gradient(1100px 700px at 65% 90%, rgba(16,185,129,.08), transparent 55%),
    var(--bg);
  color:var(--text);
}

/* Inline SVG icons */
.icon{
  width:18px;
  height:18px;
  display:inline-block;
  flex:0 0 auto;
}

.hidden{display:none!important}

.app{min-height:100%; display:flex; align-items:stretch}
.screen{width:100%; display:flex; align-items:center; justify-content:center; padding:22px}

.card{
  width:min(520px,calc(100vw - 28px));
  border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.90));
  border-radius:22px;
  box-shadow:var(--shadow);
  padding:18px;
}

html[data-theme="dark"] .card{
  background:linear-gradient(180deg, rgba(11,18,34,.90), rgba(11,18,34,.78));
}

.brand{display:flex; gap:14px; align-items:center; margin-bottom:14px}
.logo{
  width:46px; height:46px; border-radius:18px;
  display:flex; align-items:center; justify-content:center;
  border:1px solid var(--line); background:var(--soft);
}
.brand-title{font-weight:900; letter-spacing:.2px; font-size:18px}
.brand-sub{opacity:.78; font-size:13px; margin-top:2px}

.form{display:flex; flex-direction:column; gap:10px}
.label{font-size:12px; opacity:.84; font-weight:700}
.input{
  height:46px; border-radius:16px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  padding:0 14px;
  outline:none;
}
.input:focus{border-color:rgba(90,160,255,.55)}

.btn{
  height:46px;
  border-radius:16px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  font-weight:850;
}
.btn.primary{background:rgba(90,160,255,.18)}
.btn.primary:hover{background:rgba(90,160,255,.24)}
.btn.ghost{height:42px; padding:0 12px}
.btn.ghost:hover{background:var(--soft2)}
.btn.chip{height:40px; padding:0 12px; border-radius:14px}

.msg{min-height:18px; margin:0; font-size:13px}
.msg.error{color:var(--danger)}
.hint{margin-top:12px; font-size:12px; opacity:.72; line-height:1.4}

.topbar{
  position:fixed; top:0; left:0; right:0;
  display:flex; align-items:center; justify-content:space-between;
  padding:calc(12px + env(safe-area-inset-top)) 14px 12px;
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  background:var(--glass);
  border-bottom:1px solid var(--line);
  z-index:10;
}
.topbar-title{font-weight:950; display:flex; gap:10px; align-items:center}
.topbar-left{display:flex; gap:12px; align-items:center}
.topbar-right{display:flex; gap:10px; align-items:center}
.topbar-me{
  font-size:12px; opacity:.85;
  border:1px solid var(--line);
  background:var(--soft);
  padding:6px 10px;
  border-radius:999px;
  white-space:nowrap;
  max-width:min(46vw,420px);
  overflow:hidden;
  text-overflow:ellipsis;
}

#chat-screen.screen{
  align-items:stretch;
  justify-content:center;
  /* IMPORTANT: use measured topbar height so list/search isn't hidden on small screens */
  padding:calc(var(--topbar-h, 64px) + 8px) 14px 14px;
}

.dm-card{
  width:min(1040px, 100%);
  /* match the available viewport under the fixed topbar */
  height:calc(100vh - var(--topbar-h, 64px) - 22px);
  border-radius:22px;
  overflow:hidden;
  border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
  box-shadow:var(--shadow);
  display:grid;
  grid-template-columns:360px 1fr;
  min-height:0;
}

html[data-theme="dark"] .dm-card{
  background:linear-gradient(180deg, rgba(11,18,34,.92), rgba(11,18,34,.78));
}

.dm-users{border-right:1px solid var(--line); display:flex; flex-direction:column; min-height:0}
.dm-search-wrap{
  display:flex; align-items:center; gap:10px;
  margin:12px;
  border-radius:16px;
  border:1px solid var(--line);
  background:var(--soft);
  padding:10px 12px;
}
.dm-search-wrap i{opacity:.8}
.dm-users input{flex:1;border:0;background:transparent;color:var(--text);outline:none;padding:0;margin:0}

/* Messenger-style horizontal "online" strip */
.dm-online-strip{
  display:flex;
  gap:12px;
  padding:0 12px 10px 12px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none; /* Firefox */
}
.dm-online-strip::-webkit-scrollbar{display:none}

.dm-online-item{
  flex:0 0 auto;
  width:64px;
  text-align:center;
  cursor:pointer;
  user-select:none;
}
.dm-online-avatar{
  width:52px; height:52px;
  border-radius:999px;
  margin:0 auto 6px auto;
  display:flex; align-items:center; justify-content:center;
  background:var(--soft);
  border:1px solid var(--line);
  font-weight:950;
  position:relative;
}
.dm-online-name{
  font-size:12px;
  font-weight:850;
  opacity:.92;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.dm-online-item.active .dm-online-avatar{background:rgba(37,99,235,.12)}

.dm-online-sep{
  height:1px;
  background:var(--line);
  margin:0 12px 8px 12px;
}
.dm-user-list{flex:1; overflow:auto; padding:6px 8px 12px 8px}
.dm-no-results{
  padding:14px 12px;
  border-radius:14px;
  background:var(--soft2);
  border:1px solid var(--line);
  opacity:.85;
  font-weight:700;
}
.dm-user{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 10px;
  border-radius:16px; cursor:pointer; user-select:none;
}
.dm-user:hover{background:var(--soft2)}
.dm-user.active{background:rgba(37,99,235,.10)}
.dm-left{display:flex; align-items:center; gap:12px; min-width:0}
.dm-avatar{
  width:38px; height:38px;
  border-radius:14px;
  display:flex; align-items:center; justify-content:center;
  background:var(--soft);
  border:1px solid var(--line);
  font-weight:900;
  flex:0 0 auto;
  position:relative;
}
.dm-dot{
  position:absolute; right:-2px; bottom:-2px;
  width:12px; height:12px; border-radius:999px;
  background:var(--soft2);
  border:2px solid var(--card);
}
.dm-dot.online{background:#27c46b}
.dm-name{
  font-weight:900; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.dm-meta{font-size:12px; opacity:.8; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.dm-badge{
  background:#e53935; color:#fff;
  border-radius:999px;
  min-width:22px; height:22px;
  display:flex; align-items:center; justify-content:center;
  font-size:12px; padding:0 7px;
}

.dm-chat{display:flex; flex-direction:column; min-width:0; min-height:0}
.dm-chat-top{
  padding:12px 14px;
  border-bottom:1px solid var(--line);
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.dm-chat-top-left{display:flex; align-items:center; gap:10px; min-width:0}
.dm-chat-ident{display:flex; align-items:center; gap:10px; min-width:0}
.dm-chat-avatar{
  width:36px; height:36px;
  border-radius:14px;
  display:flex; align-items:center; justify-content:center;
  background:var(--soft);
  border:1px solid var(--line);
  font-weight:950;
  flex:0 0 auto;
}
.dm-chat-text{min-width:0}
.dm-chat-title{font-weight:950; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.dm-back{
  display:none;
  align-items:center; justify-content:center;
  gap:8px;
  min-width:36px;
  height:36px;
  padding:0 10px;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  cursor:pointer;
}
.dm-back-text{font-size:13px; font-weight:800}
.dm-back:hover{background:var(--soft2)}

.dm-message-list{
  flex:1; overflow:auto;
  padding:16px;
  display:flex; flex-direction:column; gap:10px;
  min-height:0;
  /* subtle wallpaper feel */
  background:
    radial-gradient(700px 500px at 30% 0%, rgba(37,99,235,.10), transparent 55%),
    radial-gradient(700px 500px at 70% 100%, rgba(249,115,22,.08), transparent 60%);
}

html[data-theme="dark"] .dm-message-list{
  background:
    radial-gradient(700px 500px at 30% 0%, rgba(96,165,250,.16), transparent 55%),
    radial-gradient(700px 500px at 70% 100%, rgba(249,115,22,.10), transparent 60%);
}
.dm-empty{
  margin:auto;
  max-width:440px;
  text-align:center;
  opacity:.86;
  padding:18px 16px;
  border-radius:18px;
  border:1px dashed var(--line);
  background:var(--glass);
}
.dm-empty-title{font-weight:950; margin-bottom:6px}
.dm-empty-sub{font-size:13px; opacity:.85}

.dm-msg{
  max-width:min(620px,92%);
  padding:10px 12px;
  border-radius:18px 18px 18px 8px;
  border:1px solid var(--line);
  background:var(--bubble-other);
  line-height:1.35;
}
.dm-msg.me{
  align-self:flex-end;
  border-radius:18px 18px 8px 18px;
  background:var(--bubble-me);
}
.dm-deleted{
  font-style:italic;
  color:var(--muted);
}
.dm-ts{font-size:11px; opacity:.72; margin-top:6px; text-align:right}

.dm-deleted{
  font-style:italic;
  color:var(--muted);
}

.dm-compose{
  display:flex;
  gap:10px;
  align-items:center;
  padding:12px 14px;
  border-top:1px solid var(--line);
}
.dm-compose input{
  flex:1;
  border-radius:16px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  padding:12px 12px;
  outline:none;
}
.dm-compose button{
  min-width:44px;
  height:44px;
  padding:0 12px;
  display:flex; align-items:center; justify-content:center;
  gap:8px;
  border-radius:16px;
  border:1px solid var(--line);
  background:rgba(37,99,235,.10);
  color:var(--text);
  cursor:pointer;
}
.dm-send-text{font-size:13px; font-weight:800}
.dm-attach-text{font-size:13px; font-weight:800}
.dm-mic-text{font-size:13px; font-weight:800}

.dm-compose button:hover{background:rgba(37,99,235,.14)}

/* WhatsApp-like mobile mode: list <-> chat with Back */
@media (max-width: 820px){
  #chat-screen.screen{padding:calc(var(--topbar-h, 64px) + 6px) 0 0}
  .dm-card{
    width:100vw;
    height:calc(100vh - var(--topbar-h, 64px));
    border-radius:0;
    grid-template-columns:1fr;
  }
  .dm-card.dm-mobile-list .dm-chat{display:none}
  .dm-card.dm-mobile-chat .dm-users{display:none}
  .dm-back{display:inline-flex}

  /* Reduce "crowded" feel on mobile */
  .dm-search-wrap{margin:10px}
  .dm-user{padding:10px 10px; border-radius:14px}
  .dm-user .dm-meta{display:none} /* keep chat header status visible */

  /* Keep the fixed topbar compact so it doesn't wrap and hide the search bar */
  .topbar{padding:calc(10px + env(safe-area-inset-top)) 10px 10px; gap:10px}
  .topbar-right{gap:8px}
  .topbar-right .btn.ghost{height:40px; width:40px; padding:0; border-radius:14px}
  .topbar-right .btn.ghost span{display:none}
  .topbar-me{max-width:42vw; font-size:11px; padding:5px 8px}
}

/* Keep the fixed topbar compact on very small screens (extra safety) */
@media (max-width: 520px){
  .topbar{padding:calc(10px + env(safe-area-inset-top)) 10px 10px; gap:10px}
  .topbar-right{gap:8px}
  .topbar-right .btn.ghost{height:40px; width:40px; padding:0; border-radius:14px}
  .topbar-right .btn.ghost span{display:none}
  .topbar-me{max-width:42vw; font-size:11px; padding:5px 8px}
}

/* On very small screens, keep the compose button compact */
@media (max-width: 420px){
  .dm-send-text{display:none}
  .dm-attach-text{display:none}
  .dm-mic-text{display:none}
  .dm-compose button{padding:0 10px}
  .dm-back-text{display:none}
  .dm-back{padding:0; width:36px}
}

/* Toast */
.toast-wrap{
  position:fixed;
  right:18px;
  top:calc(var(--topbar-h, 64px) + 8px);
  z-index:9999;
  display:flex;
  flex-direction:column;
  gap:10px;
  max-width:min(420px,calc(100vw - 36px));
}

/* Message actions + edit modal (Messenger-like long-press menu) */
.dm-sheet-backdrop{
  position:fixed;
  inset:0;
  z-index:10000;
  background:rgba(0,0,0,.38);
  backdrop-filter:blur(6px);
  -webkit-backdrop-filter:blur(6px);
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding:18px;
}
.dm-sheet{
  width:min(560px, 100%);
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 30px 120px rgba(0,0,0,.30);
}
html[data-theme="dark"] .dm-sheet{background:rgba(11,18,34,.94)}
.dm-sheet-head{padding:14px 14px 10px 14px; font-weight:950; border-bottom:1px solid var(--line)}
.dm-sheet-body{padding:12px 14px; display:flex; flex-direction:column; gap:10px}
.dm-sheet-actions{padding:12px 14px 14px 14px; display:flex; gap:10px; justify-content:flex-end; border-top:1px solid var(--line)}
.dm-sheet-btn{
  height:42px;
  padding:0 14px;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  cursor:pointer;
  font-weight:900;
}
.dm-sheet-btn:hover{background:var(--soft2)}
.dm-sheet-btn.danger{background:rgba(228,37,37,.14)}
.dm-sheet-btn.danger:hover{background:rgba(228,37,37,.20)}
.dm-edit-area{
  width:100%;
  min-height:92px;
  resize:vertical;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--text);
  padding:10px 12px;
  outline:none;
  font-family:inherit;
  font-size:14px;
  line-height:1.35;
}
.dm-edit-hint{font-size:12px; opacity:.78}
.toast{
  background:var(--glass);
  color:var(--text);
  border:1px solid var(--line);
  backdrop-filter:blur(14px);
  -webkit-backdrop-filter:blur(14px);
  border-radius:16px;
  padding:12px 14px;
  box-shadow:0 18px 60px rgba(0,0,0,.14);
}

html[data-theme="dark"] .toast{
  background:rgba(11,18,34,.88);
  border:1px solid var(--line);
}

/* Floating theme toggle (works on login + chat) */
.theme-float{
  position:fixed;
  right:14px;
  bottom:14px;
  z-index:9998;
  height:42px;
  padding:0 12px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  border-radius:999px;
  border:1px solid var(--line);
  background:var(--glass);
  color:var(--text);
  backdrop-filter:blur(16px);
  -webkit-backdrop-filter:blur(16px);
  cursor:pointer;
  box-shadow:0 18px 70px rgba(0,0,0,.14);
}
.theme-float:hover{background:var(--soft2)}
.theme-text{font-weight:900; font-size:13px}
@media (max-width: 420px){
  .theme-text{display:none}
  .theme-float{padding:0; width:42px}
}
.toast b{display:block; margin-bottom:4px}
@media (max-width: 820px){
  .toast-wrap{left:14px; right:14px; top:calc(var(--topbar-h, 64px) + 8px); max-width:none}
}


.dm-compose button:disabled{opacity:.6; cursor:not-allowed}


.dm-img{
  display:block;
  max-width:min(340px,70vw);
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--soft);
}
.dm-img-wrap{display:block; cursor:pointer}
.dm-caption{margin-top:8px; white-space:pre-wrap}


.dm-rec-ind{
  font-size:12px;
  font-weight:800;
  color:var(--danger);
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(180,35,24,.22);
  background:rgba(180,35,24,.06);
  white-space:nowrap;
}

#dm-mic.recording{
  background:rgba(180,35,24,.12);
  border-color:rgba(180,35,24,.25);
}

.dm-audio{
  width:min(360px,72vw);
  max-width:100%;
}

.dm-audio-meta{
  margin-top:8px;
  font-size:12px;
  opacity:.8;
}
