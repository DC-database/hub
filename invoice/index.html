<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="transfer_stock.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

    <div id="app-container">

        <div id="login-view">
            <div class="form-container animated-card desktop-only-login">
                <h2>System Login</h2>
                <p>Please enter your IBA mobile number to continue.</p>
                <form id="login-form">
                    <input type="text" id="login-identifier" placeholder="IBA Mobile Number" required>
                    <button type="submit">Continue</button>
                </form>
                <p id="login-error" class="error-message"></p>
                <p id="app-version-display" class="version-display"></p>
            </div>

            <div class="mobile-login-container">
                <div class="iba-logo-anim">
                    <span>I</span><span>B</span><span>A</span>
                </div>
                <audio id="login-sound" src="https://firebasestorage.googleapis.com/v0/b/ibainvoice-3ea51.firebasestorage.app/o/ding.mp3?alt=media&token=db2ac5ce-c1c6-4941-830b-2eabf7c76f9e"></audio>

                <div class="mobile-login-form-wrapper">
                    <h2 style="color: white; margin-bottom: 20px;">Welcome</h2>
                    <form id="mobile-login-form">
                        <div class="input-icon-wrap">
                            <i class="fa-solid fa-mobile-screen"></i>
                            <input type="text" id="mobile-login-identifier" placeholder="Mobile Number" required>
                        </div>
                        <div class="input-icon-wrap">
                            <i class="fa-solid fa-lock"></i>
                            <input type="password" id="mobile-login-password" placeholder="Password" required>
                        </div>
                        <button type="submit" class="mobile-login-btn">Login</button>
                    </form>
                    <p id="mobile-login-error" class="error-message" style="color: #ffcccc;"></p>
                    <a href="https://www.iba.com.qa" target="_blank" class="iba-web-link">www.iba.com.qa</a>
                </div>
            </div>
        </div>

        <div id="password-view" class="hidden"><div class="form-container animated-card"><h2>Enter Password</h2><p>Welcome back! Please enter your password for <strong id="password-user-identifier"></strong>.</p><form id="password-form"><input type="password" id="login-password" placeholder="Password" required><button type="submit">Login</button></form><p id="password-error" class="error-message"></p></div></div>

        <div id="setup-view" class="hidden"><div class="form-container animated-card"><h2>Complete Your Account Setup</h2><p>This is your first time logging in. Please complete the following steps.</p><form id="setup-form"><div id="setup-email-container" class="hidden"><label for="setup-email">Enter your email address:</label><input type="email" id="setup-email" placeholder="user@example.com" required></div><div id="setup-site-container" class="hidden"><label for="setup-site">Enter your Site:</label><input type="text" id="setup-site" placeholder="Site Name" required><p class="input-note">For multiple sites, separate them with a comma (ex. 175,176)</p></div><div id="setup-position-container" class="hidden"><label for="setup-position">Enter your Position:</label><input type="text" id="setup-position" placeholder="Position" required></div><label for="setup-password">Create Password</label><input type="password" id="setup-password" placeholder="New Password" required><button type="submit">Complete Setup</button></form><p id="setup-error" class="error-message"></p></div></div>

        <div id="dashboard-view" class="hidden">
            <div class="form-container animated-card">
                <header class="dashboard-header">
                    <div id="user-info">
                        <span id="dashboard-username"></span>
                    </div>
                    <button id="logout-button">Logout</button>
                </header>
                <main class="dashboard-main">
                    <div class="button-container">
                        <button id="workdesk-button" class="circle-button">WorkDesk</button>
                        <button id="invoice-mgmt-button" class="circle-button">Invoice Management</button>
			<button id="inventory-button" class="circle-button">Inventory</button>
                        <a href="https://ibaport.site/Finance/" target="_blank" class="circle-button hidden" id="finance-report-button">Finance Report</a>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <div id="workdesk-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile">
                <div class="wd-user-avatar"><i class="fa-solid fa-user"></i></div>
                <h3 id="wd-username">User Name</h3>
                <p id="wd-user-identifier">user@iba.com.qa</p>
            </div>

            <a href="#" id="back-to-dashboard-button" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="workdesk-nav" class="workdesk-navigation">
                <ul>
                    <li class="wd-nav-dashboard"><a href="#" data-section="wd-dashboard" class="active"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
		    <li>
    <a href="#" id="wd-sidebar-add-job-btn" style="color: #ffc107; font-weight: bold;">
        <i class="fa-solid fa-circle-plus"></i> Add New Job
    </a>
</li>
                    <li class="wd-nav-activetask"><a href="#" data-section="wd-activetask"><i class="fa-solid fa-list-check"></i> Active Task <span id="wd-active-task-badge" class="notification-badge" style="display: none;">0</span></a></li>
                    <li class="wd-nav-taskhistory hidden"><a href="#" data-section="wd-taskhistory"><i class="fa-solid fa-clock-rotate-left"></i> Task History</a></li>
                    <li class="wd-nav-reporting"><a href="#" data-section="wd-reporting"><i class="fa-solid fa-chart-line"></i> Job Records</a></li>

                    <li class="wd-nav-material"><a href="#" data-section="wd-material-stock"><i class="fa-solid fa-boxes-stacked"></i> Material Stock</a></li>

                    <li class="wd-nav-im-reporting-mobile"><a href="#" id="wd-im-reporting-link-mobile"><i class="fa-solid fa-chart-line"></i> Reporting</a></li>

                    <li class="mobile-only-nav-item"><a href="#" id="mobile-nav-logout"><i class="fa-solid fa-power-off" style="color: #C3502F;"></i> <span style="color: #C3502F;">Logout</span></a></li>
                </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li id="workdesk-im-link-container" class="hidden" style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px;">
                        <a href="#" id="workdesk-im-link"><i class="fa-solid fa-file-invoice-dollar"></i> Invoice Management</a>
                    </li>
                    <li><a href="#" data-section="wd-settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
                    <li><a href="#" id="wd-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>

            <div class="sidebar-footer-info">
                <span id="workdesk-datetime"></span>
                <p class="version-display sidebar-version-display"></p>
            </div>
        </aside>

        <div class="workdesk-main" role="main">
            <div id="workdesk-content-area">

                <section id="wd-dashboard" class="workdesk-section">
                    <h1>Dashboard</h1>

                    <div class="dashboard-summary-cards">
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #ffc107;"><i class="fa-solid fa-list-check"></i></div>
                            <div class="card-details">
                                <span id="db-active-tasks-count" class="card-value">0</span>
                                <span class="card-label">Total Active Tasks</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #28a745;"><i class="fa-solid fa-check-double"></i></div>
                            <div class="card-details">
                                <span id="db-completed-tasks-count" class="card-value">0</span>
                                <span class="card-label">Total Tasks Completed</span>
                            </div>
                        </div>
                    </div>

                    <hr class="section-divider">

                    <div id="wd-calendar-widget">
                        <h2>Task Calendar</h2>
                        <div class="wd-calendar-legend">
                            <div class="legend-item">
                                <span class="legend-color-dot status-red"></span> Active Task
                            </div>
                            <div class="legend-item">
                                <span class="legend-color-dot status-yellow"></span> Pending Signature
                            </div>
                            <div class="legend-item legend-admin-only">
                                <span class="legend-color-dot status-green"></span> View-Only (Admin)
                            </div>
                        </div>

                        <div id="wd-calendar-container">
                            <div id="wd-calendar-header">
                                <button id="wd-calendar-toggle-view" title="Toggle Year/Month View">Year View</button>
                                <button id="wd-calendar-prev" title="Previous month/year">&larr;</button>
                                <h3 id="wd-calendar-month-year">Month Year</h3>
                                <button id="wd-calendar-next" title="Next month/year">&rarr;</button>
                            </div>
                            <div id="wd-calendar-grid">
                                <div class="wd-calendar-day-name">Sun</div>
                                <div class="wd-calendar-day-name">Mon</div>
                                <div class="wd-calendar-day-name">Tue</div>
                                <div class="wd-calendar-day-name">Wed</div>
                                <div class="wd-calendar-day-name">Thu</div>
                                <div class="wd-calendar-day-name">Fri</div>
                                <div class="wd-calendar-day-name">Sat</div>
                            </div>
                            <div id="wd-calendar-year-grid" class="hidden">
                            </div>
                        </div>
                        <div id="wd-calendar-task-list">
                            <h3 id="wd-calendar-task-list-title">Select a day to see tasks</h3>
                            <ul id="wd-calendar-task-list-ul">
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="wd-dayview" class="workdesk-section hidden">
                    <div class="dayview-mobile-header-new">
                        <button id="wd-dayview-mobile-menu-btn" class="dayview-mobile-icon-btn" type="button" title="Back to Calendar"><i class="fa-solid fa-bars"></i></button>
                        <button id="wd-dayview-mobile-notify-btn" class="dayview-mobile-icon-btn" type="button" title="Notifications">
                            <i class="fa-solid fa-bell"></i>
                            <span id="wd-mobile-notify-badge" class="notification-badge" style="display: none;">0</span>
                        </button>
                        <button id="wd-dayview-mobile-logout-btn-new" class="dayview-mobile-icon-btn dayview-mobile-logout" type="button" title="Logout"><i class="fa-solid fa-power-off"></i></button>
                    </div>
                    <div class="dayview-mobile-titles">
                        <h1>My Task</h1>
                        <p id="wd-dayview-mobile-date-subtitle">Today</p>
                    </div>
                    <div class="dayview-date-scroller">
                        <div id="wd-dayview-date-scroller-inner"></div>
                    </div>
                    <div class="dayview-header">
                        <button id="wd-dayview-back-btn" class="secondary-btn" type="button"><i class="fa-solid fa-arrow-left"></i> Back to Calendar</button>
                        <div class="dayview-date-nav">
                            <button id="wd-dayview-prev-btn" class="secondary-btn" title="Previous day">&larr;</button>
                            <h1 id="wd-dayview-title">Tasks for...</h1>
                            <button id="wd-dayview-next-btn" class="secondary-btn" title="Next day">&rarr;</button>
                        </div>
                    </div>
                    <div class="dayview-task-container-blue">
                        <div id="wd-dayview-task-list"></div>
                    </div>
                </section>


<section id="wd-jobentry" class="workdesk-section hidden">
    <div class="jobentry-header-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1 style="margin: 0;">Job Entry Records</h1>
        <div style="display: flex; gap: 10px;">
            <div id="jobentry-nav-controls" class="hidden" style="display: flex; align-items: center; gap: 5px;">
                <button type="button" id="nav-prev-job" class="secondary-btn" title="Previous">&larr;</button>
                <span id="nav-job-counter" style="font-weight: bold; padding: 0 5px;"></span>
                <button type="button" id="nav-next-job" class="secondary-btn" title="Next">&rarr;</button>
            </div>

<button class="download-btn btn-open-standard-modal" style="background-color: #003A5C;">
    <i class="fa-solid fa-plus"></i> Add New Job
</button>
        </div>
    </div>

    <div class="search-and-table-container">
        <div class="search-bar-local">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="job-entry-search" placeholder="Search by Ref, PO, Site, or Group...">
        </div>
        <div id="job-entry-table-wrapper" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Job</th>
                        <th>Ref</th>
                        <th>PO</th>
                        <th>Site</th>
                        <th>Group</th>
                        <th>Attention</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="job-entry-table-body"></tbody>
            </table>
        </div>
    </div>
</section>
                <section id="wd-activetask" class="workdesk-section hidden">

                    <div id="active-task-mobile-header" class="hidden-desktop">
                        <button id="mobile-activetask-refresh-btn" class="mobile-header-icon" title="Refresh Tasks">
                            <i class="fa-solid fa-sync"></i>
                        </button>
                        <h1>My Tasks</h1>

                    </div>

                    <h1 class="hidden-mobile">Your Active Tasks <span id="active-task-count-display" class="table-count-display"></span></h1>

                    <div class="search-and-filter-group" style="margin-bottom: 20px;">
                        <div class="search-bar-local" style="margin-bottom: 0;">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="active-task-search" placeholder="Type to search your active tasks...">
                        </div>
                        <button id="active-task-clear-button" class="secondary-btn" type="button">Clear</button>
                    </div>

                    <div id="active-task-filters" class="report-tabs" style="margin-bottom: 20px;"></div>

                    <div class="form-buttons-container" style="justify-content: flex-end; margin-bottom: 15px;">
                        <button id="send-ceo-approval-receipt-btn" class="download-btn hidden" type="button">
                            <i class="fa-brands fa-whatsapp"></i> Send Approval Receipt
                        </button>
                    </div>

                    <div class="table-wrapper hidden-mobile">
                        <table class="mobile-optimized-table">
                            <thead>
                                <tr>
                                    <th class="desktop-only">Job</th>
                                    <th class="desktop-only">Ref</th>
                                    <th class="desktop-only">PO</th>
                                    <th class="desktop-only">Vendor Name</th>
                                    <th class="desktop-only">Invoice Amount</th>
                                    <th class="desktop-only">Site</th>
                                    <th class="desktop-only col-group">Group</th>
                                    <th class="desktop-only">Date</th>
                                    <th class="desktop-only">Status</th>
                                    <th class="desktop-only">Action</th>
                                </tr>
                            </thead>
                            <tbody id="active-task-table-body"></tbody>
                        </table>
                    </div>

                    <div id="active-task-mobile-view" class="hidden-desktop">
                        </div>

                    <div id="mobile-receipt-action-container" class="hidden">
    <button id="mobile-send-receipt-btn" class="whatsapp-float-btn hidden" style="background-color: #25D366; font-weight: 800; animation: pulse 2s infinite;">
        <span style="font-size: 1.2rem; margin-right: 5px;">ðŸš¨</span> REQUIRED: Click Here to Finalize
    </button>

    <button id="mobile-send-manager-receipt-btn" class="whatsapp-float-btn hidden" style="background-color: #00748C; font-weight: 800; animation: pulse 2s infinite;">
        <span style="font-size: 1.2rem; margin-right: 5px;">ðŸš¨</span> REQUIRED: Click Here to Finalize
    </button>
</div>
                </section>

                 <section id="wd-taskhistory" class="workdesk-section hidden">
                    <h1>Task History</h1>
                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="task-history-search" placeholder="Type to search your task history...">
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead><tr><th>Job</th><th>Ref</th><th>Amount</th><th>PO</th><th>Site</th><th>Group</th><th>Date Entered</th><th>Date Responded</th><th>Remarks</th></tr></thead>
                            <tbody id="task-history-table-body"></tbody>
                        </table>
                    </div>
                </section>

<section id="wd-reporting" class="workdesk-section hidden">
    <h1>
        Job Records
        <span id="job-records-count-display" class="table-count-display"></span>
    </h1>

    <div class="report-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">

        <div class="report-tabs-container" style="flex-grow: 1;">
            <div id="report-tabs" class="report-tabs"></div>
        </div>

        <div style="display: flex; gap: 5px;">
            <button class="download-btn btn-open-standard-modal" style="background-color: #00748C; border: none;">
                <i class="fa-solid fa-plus"></i> Add New Job
            </button>
            
        </div>
    </div>

    <div class="search-bar-local">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" id="reporting-search" placeholder="Type to search all system entries...">
    </div>

    <div id="reporting-printable-area">
        <div class="table-wrapper">
            <table id="job-records-table">
                <thead>
                    <tr>
                        <th>Job</th>
                        <th>Ref</th>
                        <th>Site</th>
                        <th>PO</th>
                        <th>Vendor Name</th>
                        <th>Amount</th>
                        <th>Entered By</th>
                        <th>Date Entered</th>
                        <th>Attention</th>
                        <th>Date Responded</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reporting-table-body"></tbody>
            </table>
        </div>
    </div>
</section>

<section id="wd-material-stock" class="workdesk-section hidden">
    <h1>
    Material Stock 
    <span id="ms-total-count" class="table-count-display"></span>
</h1>

    <div class="report-controls" style="margin-bottom: 20px; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
        <div style="display: flex; gap: 5px;">
            <button id="ms-add-new-btn" style="background-color: #00748C;"><i class="fa-solid fa-plus"></i> Add Material</button>
            <button id="ms-upload-csv-btn" class="secondary-btn"><i class="fa-solid fa-file-csv"></i> Upload</button>
            <button id="ms-template-btn" class="secondary-btn" style="background-color: #6c757d;"><i class="fa-solid fa-download"></i> Template</button>
            <input type="file" id="ms-csv-file-input" accept=".csv" style="display: none;">
            <button id="ms-refresh-btn" class="secondary-btn" title="Force Refresh"><i class="fa-solid fa-sync"></i></button>
            <button id="ms-open-report-modal-btn" class="download-btn" title="Open Stock Report" style="background-color: #6f42c1; color: white; border: none;"><i class="fa-solid fa-chart-pie"></i> Stock Report</button>
	   <button id="ms-bulk-delete-btn" class="delete-btn hidden" style="background-color: #dc3545;"><i class="fa-solid fa-trash-can"></i> Delete Selected</button>
</div>

        
    </div>

    <div id="ms-category-tabs" class="report-tabs" style="margin-bottom: 15px; border-bottom: 2px solid #eee; overflow-x: auto; white-space: nowrap; display: flex; gap: 10px; padding-bottom: 5px;">
        <span style="color:#999; font-style:italic; padding:10px;">Loading categories...</span>
    </div>

    <div id="ms-search-container" style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px; gap: 20px;">

    <div style="display: flex; gap: 10px; align-items: center; flex-grow: 1; max-width: 50%;"> 
        <div class="search-bar-local" style="flex-grow: 1; margin-bottom: 0; position: relative; height: 40px;">
            <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #888;"></i>
            <input type="text" id="ms-search-input" placeholder="Search by Product ID or Name..." style="width: 100%; height: 100%; padding-left: 35px; margin-bottom: 0; padding-top:0; padding-bottom:0;">
        </div>
        <button type="button" id="ms-search-clear-btn" class="secondary-btn" style="background-color: #dc3545; color: white; border: none; white-space: nowrap; height: 40px; padding: 0 20px; border-radius: 4px; display: flex; align-items: center;">
            Clear
        </button>
    </div>

    <div style="display: flex; gap: 5px; align-items: center;">
        <button onclick="openTransferModal('Transfer')" style="background-color: #17a2b8; color: white; padding: 0 15px; border: none; border-radius: 4px; cursor: pointer; height: 40px; display: flex; align-items: center; gap: 5px; font-weight: 600;">
            <i class="fa-solid fa-arrow-right-arrow-left"></i> Transfer
        </button>
        <button onclick="openTransferModal('Restock')" style="background-color: #28a745; color: white; padding: 0 15px; border: none; border-radius: 4px; cursor: pointer; height: 40px; display: flex; align-items: center; gap: 5px; font-weight: 600;">
            <i class="fa-solid fa-boxes-packing"></i> Restock
        </button>
        <button onclick="openTransferModal('Usage')" style="background-color: #6f42c1; color: white; padding: 0 15px; border: none; border-radius: 4px; cursor: pointer; height: 40px; display: flex; align-items: center; gap: 5px; font-weight: 600;">
            <i class="fa-solid fa-screwdriver-wrench"></i> Usage
        </button>
    </div>

</div>
    
    <div class="table-wrapper">
        <table id="ms-table">
           <thead>
                <tr>
                    <th style="width: 50px;"></th>
                    <th style="width: 15%;">Product ID</th>
                    <th style="width: 25%;">Product Name</th>
                    <th style="width: 10%;">Category</th> <th style="width: 20%;">Details</th>
                    <th style="width: 10%;">Total Stock</th>
                    <th style="width: 10%; text-align: center;">Action</th>
                </tr>
            </thead>
            <tbody id="ms-table-body">
                <tr><td colspan="7" style="text-align:center; padding:30px; color:#777;">Please select a Category tab above to view stock.</td></tr>
            </tbody>
        </table>
    </div>
</section>

<div id="ms-report-modal" class="modal-overlay hidden">
    <div class="modal-container" style="max-width: 900px; height: 90vh; display: flex; flex-direction: column;">
        <div class="modal-header">
            <h2>Material Stock Report</h2>
            <button class="modal-close-btn" onclick="document.getElementById('ms-report-modal').classList.add('hidden')">&times;</button>
        </div>
        
        <div class="modal-content" id="ms-report-print-content" style="overflow-y: auto; padding: 20px;">
            
            <div class="print-only-header">
                <div style="border-bottom: 2px solid #003A5C; padding-bottom: 10px; margin-bottom: 20px;">
                    <h1 style="margin: 0; color: #003A5C;">ISMAIL BIN ALI TRADING & CONT. CO. W.L.L</h1>
                    <p style="margin: 5px 0 0 0; color: #555;">Material Stock Status Report</p>
                    <p style="margin: 0; font-size: 0.9rem; color: #777;">Generated: <span id="ms-report-date"></span></p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;">
                    <span style="display:block; font-size: 0.9rem; color: #666;">Total Items</span>
                    <strong id="ms-report-total" style="font-size: 1.5rem; color: #333;">0</strong>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #c8e6c9;">
                    <span style="display:block; font-size: 0.9rem; color: #2e7d32;">In Stock</span>
                    <strong id="ms-report-instock" style="font-size: 1.5rem; color: #2e7d32;">0</strong>
                </div>
                <div style="background: #ffebee; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ffcdd2;">
                    <span style="display:block; font-size: 0.9rem; color: #c62828;">Out of Stock</span>
                    <strong id="ms-report-outstock" style="font-size: 1.5rem; color: #c62828;">0</strong>
                </div>
            </div>

            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                <thead style="background: #003A5C; color: white;">
                    <tr>
                        <th style="padding: 10px; text-align: left;">Product ID</th>
                        <th style="padding: 10px; text-align: left;">Name</th>
                        <th style="padding: 10px; text-align: center;">Total Qty</th>
                        <th style="padding: 10px; text-align: left;">Location Breakdown</th>
                    </tr>
                </thead>
                <tbody id="ms-report-table-body">
                    </tbody>
            </table>
            
            <div class="print-footer" style="margin-top: 30px; border-top: 1px solid #ccc; padding-top: 10px; display: flex; justify-content: space-between; font-size: 0.8rem; display: none;">
                <span>System Generated Report</span>
                <span>Page 1 of 1</span>
            </div>
        </div>

        <div class="modal-footer" style="background: #f8f9fa; border-top: 1px solid #ddd; padding: 15px;">
            <button class="secondary-btn modal-close-btn" onclick="document.getElementById('ms-report-modal').classList.add('hidden')">Close</button>
            <div style="display: flex; gap: 10px;">
                <button id="ms-modal-print-btn" class="print-btn" style="background-color: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 4px;">
                    <i class="fa-solid fa-print"></i> Print PDF
                </button>
                <button id="ms-modal-excel-btn" class="download-btn" style="background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px;">
                    <i class="fa-solid fa-file-excel"></i> Export Excel
                </button>
            </div>
        </div>
    </div>
</div>

                 <section id="wd-settings" class="workdesk-section hidden">
                    <h1>Account Settings</h1>
                    <p>Manage your personal information and preferences. Fields that are greyed out are managed by the system administrator.</p>
                    <form id="settings-form">
                        <div class="jobentry-form-2col">
                            <div class="form-column">
                                <div class="form-group"><label for="settings-name">Name</label><input type="text" id="settings-name" readonly></div>
                                <div class="form-group"><label for="settings-email">Email</label><input type="email" id="settings-email" readonly></div>
                                <div class="form-group"><label for="settings-mobile">Mobile</label><input type="text" id="settings-mobile" readonly></div>
                                <div class="form-group"><label for="settings-position">Position</label><input type="text" id="settings-position" readonly></div>
                            </div>
                            <div class="form-column">
                                <div class="form-group"><label for="settings-site">Site</label><input type="text" id="settings-site" placeholder="Your site(s)"><p class="input-note">For multiple sites, separate them with a comma (ex. 175,176)</p></div>
                                <div class="form-group"><label for="settings-password">New Password</label><input type="password" id="settings-password" placeholder="Leave blank to keep current password"></div>
                                <div class="form-group"><div class="checkbox-group"><input type="checkbox" id="settings-vacation"><label for="settings-vacation">On Vacation</label></div></div>
                                <div id="settings-vacation-details-container" class="hidden">
                                    <div class="form-group"><label for="settings-return-date">Return Date</label><input type="date" id="settings-return-date"></div>
                                    <div class="form-group"><label for="settings-replacement-name">Replacement</label><input type="text" id="settings-replacement-name" placeholder="Replacement's Name"></div>
                                    <div class="form-group"><label for="settings-replacement-contact">Replacement Contact No.</label><input type="tel" id="settings-replacement-contact" placeholder="Replacement's Contact"></div>
                                    <div class="form-group"><label for="settings-replacement-email">Replacement Email</label><input type="email" id="settings-replacement-email" placeholder="Replacement's Email"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-buttons-container" style="justify-content: flex-start; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;"><button type="submit" id="update-settings-button">Update Settings</button></div>
                        <p id="settings-message" class="error-message" style="text-align: left;"></p>
                    </form>
                </section>
            </div>
        </div>

    </div>

<div id="inventory-view" class="hidden">
    <aside class="workdesk-sidebar">
        <div class="wd-user-profile">
            <div class="wd-user-avatar" style="background-color: #28a745; color: white;"><i class="fa-solid fa-boxes-stacked"></i></div>
            <h3 id="inv-username">User</h3>
            <p id="inv-user-identifier">Inventory Access</p>
        </div>
        
        <a href="#" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</a>

        <nav id="inv-nav" class="workdesk-navigation">
            <ul>
                <li class="active"><a href="#" class="active"><i class="fa-solid fa-boxes-stacked"></i> Material Stock</a></li>
            </ul>
        </nav>

        <div class="workdesk-footer-nav">
            <ul>
                <li><a href="#" id="inv-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
            </ul>
        </div>
    </aside>

    <div class="workdesk-main" role="main">
        <section id="inv-material-stock" class="workdesk-section">
            <h1>Inventory Management</h1>
            <div id="inventory-content-placeholder"></div>
        </section>
    </div>
</div>


    <div id="invoice-management-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile">
                <div class="wd-user-avatar"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                <h3 id="im-username">User Name</h3>
                <p id="im-user-identifier">user@iba.com.qa</p>
            </div>

            <a href="#" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="im-nav" class="workdesk-navigation">
                <ul>

                    <li class="wd-nav-activetask-mobile">
                        <a href="#" id="im-mobile-activetask-link">
                            <i class="fa-solid fa-list-check"></i> Active Task
                            <span id="im-mobile-nav-badge" class="notification-badge" style="display: none;">0</span>
                        </a>
                    </li>

                    <li class="im-nav-dashboard desktop-only-li">
                        <a href="#" id="im-dashboard-nav-link" data-section="im-dashboard" class="active" title="Double-click to load charts">
                            <i class="fa-solid fa-table-columns"></i> Dashboard
                        </a>
                    </li>
                    <li class="im-nav-reporting"><a href="#" data-section="im-reporting"><i class="fa-solid fa-chart-line"></i> Invoice Records</a></li>

                    <li class="wd-nav-im-reporting-mobile"><a href="#" id="im-nav-reporting-link-mobile"><i class="fa-solid fa-chart-line"></i> Invoice Records</a></li>

                    <li class="nav-section-divider im-nav-invoice-entry desktop-only-li" style="border-top: 1px solid rgba(255,255,255,0.3) !important;"><a href="#" data-section="im-invoice-entry"><i class="fa-solid fa-file-pen"></i> Invoice Entry</a></li>
                    <li class="im-nav-batch-entry desktop-only-li"><a href="#" id="batch-entry-nav-link" data-section="im-batch-entry"><i class="fa-solid fa-file-excel"></i> Batch Entry</a></li>
                    <li class="im-nav-summary-note desktop-only-li"><a href="#" id="summary-note-nav-link" data-section="im-summary-note"><i class="fa-solid fa-receipt"></i> Summary Note</a></li>

                    <li class="nav-section-divider im-nav-payments desktop-only-li" style="border-top: 1px solid rgba(255,255,255,0.3) !important;"><a href="#" id="payments-nav-link" data-section="im-payments" class="hidden"><i class="fa-solid fa-money-check-dollar"></i> Payments</a></li>
                    <li class="im-nav-finance-report desktop-only-li"><a href="#" id="im-finance-report-nav-link" data-section="im-finance-report"><i class="fa-solid fa-building-columns"></i> Finance Report</a></li>

                    <li class="mobile-only-nav-item">
                        <a href="#" id="im-mobile-nav-logout">
                            <i class="fa-solid fa-power-off" style="color: #C3502F;"></i>
                            <span style="color: #C3502F;">Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li id="im-nav-workdesk" class="hidden" style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px;">
                        <a href="#" id="im-workdesk-button"><i class="fa-solid fa-briefcase"></i> WorkDesk</a>
                    </li>
                    <li class="im-nav-activetask-link"><a href="#" id="im-activetask-button"><i class="fa-solid fa-list-check"></i> Active Task <span id="im-active-task-badge" class="notification-badge" style="display: none;">0</span></a></li>
                    <li><a href="#" id="im-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>

            <span id="im-datetime"></span>
            <p class="version-display sidebar-version-display"></p>

        </aside>

        <aside id="im-entry-sidebar" class="im-entry-sidebar hidden">
            <h3 id="active-jobs-sidebar-count-display" class="im-sidebar-title">Your Active Invoice Jobs (0)</h3>
            <ul id="im-entry-sidebar-list" class="im-sidebar-list">
            </ul>
        </aside>

        <div class="workdesk-main" role="main">
             <div id="im-content-area">

                <section id="im-dashboard" class="workdesk-section">
                    <h1>Dashboard</h1>
                </section>

                <section id="im-invoice-entry" class="workdesk-section hidden">
                    <h1>Invoice Entry
                        <button id="im-show-active-jobs-btn" class="secondary-btn" type="button">
                            <i class="fa-solid fa-list-check"></i> Active Jobs
                        </button>
                    </h1>
                    <div id="im-po-search-container">
                        <div class="search-bar-local">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="im-po-search-input" placeholder="Enter PO Number...">
                        </div>
                        <button id="im-po-search-button">Search PO</button>
                        <button id="im-refresh-entry-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i></button>
                    </div>

                    <div id="im-modal-po-details" class="im-po-details-compact hidden">
    <div class="po-compact-grid">
       <div><label>PO:</label> <span class="im-po-no">---</span></div>
       <div><label>Site:</label> <span class="im-po-site">---</span></div>
       <div><label>Val:</label> <span class="im-po-value">---</span></div>
       <div><label>Vendor:</label> <span class="im-po-vendor">---</span></div>
    </div>
</div>

                    <div id="im-invoice-form-trigger" class="hidden" style="margin-top: 10px; margin-bottom: 10px; display: flex; justify-content: flex-end;">
    <button id="im-open-invoice-form-btn" type="button" class="download-btn" style="background-color: #00748C;">
        <i class="fa-solid fa-plus"></i> Add / Edit Invoice
    </button>
</div>

<div id="im-invoice-entry-modal" class="modal-overlay hidden">
    <div class="modal-container">
        
<div class="modal-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <h2 id="im-form-title" style="margin: 0;">Invoice Entry</h2>
                
                <div id="im-nav-controls" class="hidden" style="display: flex; align-items: center; gap: 5px;">
                    <button type="button" id="im-nav-prev" class="secondary-btn" title="Previous Invoice" style="padding: 2px 8px; height: 30px; min-width: 30px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">&larr;</button>
                    
                    <span id="im-nav-counter" style="color: white; font-weight: bold; font-size: 0.9rem; min-width: 50px; text-align: center;"></span>
                    
                    <button type="button" id="im-nav-next" class="secondary-btn" title="Next Invoice" style="padding: 2px 8px; height: 30px; min-width: 30px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">&rarr;</button>
                </div>
            </div>
            <button type="button" class="modal-close-btn">&times;</button>
        </div>


        <div class="modal-content">



<form id="im-new-invoice-form" class="hidden">
    <div class="form-grid-compact">

        <div class="form-group im-compact">
            <label>Entry ID</label>
            <input type="text" id="im-inv-entry-id" name="invEntryID" readonly style="background-color:#f0f0f0;">
        </div>
        <div class="form-group is-required">
            <label>Invoice No.</label>
            <input type="text" id="im-inv-no" name="invNumber">
        </div>

        <div class="form-group is-required">
            <label>Value</label>
            <input type="number" id="im-inv-value" name="invValue" step="0.01">
        </div>
        <div class="form-group is-required">
            <label>Inv Date</label>
            <input type="date" id="im-invoice-date" name="invoiceDate">
        </div>

        <div class="form-group">
            <label>Amt Paid</label>
            <input type="number" id="im-amount-paid" name="amountPaid" step="0.01">
        </div>
        <div class="form-group">
            <label>Release</label>
            <input type="date" id="im-release-date" name="releaseDate">
        </div>

        <div class="form-group is-required">
            <label>Status</label>
            <select id="im-status" name="status">
                <option value="For SRV">For SRV</option>
                <option value="Pending">Pending</option>
                <option value="For IPC">For IPC</option>
                <option value="Under Review">Under Review</option>
                <option value="For Approval">For Approval</option>
                <option value="CEO Approval">CEO Approval</option>
                <option value="Report">Report</option>
                <option value="With Accounts">With Accounts</option>
                <option value="Original PO">Original PO</option>
            </select>
        </div>
        <div class="form-group is-required" id="im-attention-group">
            <label>Attention</label>
            <select id="im-attention" name="attention"></select>
        </div>

        <div class="form-group">
            <label>Invoice Name</label>
            <div style="display: flex; gap: 3px;">
                <input type="text" id="im-inv-name" name="invName" style="flex-grow: 1;">
                <a href="#" class="secondary-btn" style="width:30px; padding:0; display:flex; align-items:center; justify-content:center; background-color:#00748C; color:white; border-radius:4px;"><i class="fa-solid fa-cloud-arrow-up"></i></a>
            </div>
        </div>
        <div class="form-group">
            <label>SRV Name</label>
            <div style="display: flex; gap: 3px;">
                <input type="text" id="im-srv-name" name="srvName" style="flex-grow: 1;">
                <a href="#" class="secondary-btn" style="width:30px; padding:0; display:flex; align-items:center; justify-content:center; background-color:#00748C; color:white; border-radius:4px;"><i class="fa-solid fa-cloud-arrow-up"></i></a>
            </div>
        </div>

        <div class="form-group" style="grid-column: span 2;">
            <label>Details</label>
            <input type="text" id="im-details" name="details">
        </div>
        <div class="form-group" id="im-note-group" style="grid-column: span 2;">
            <label>Note</label>
            <textarea id="im-note" name="note" style="height: 35px; min-height: 35px;"></textarea>
        </div>

    </div>

    <div id="im-po-search-container-bottom" class="im-po-search-container-bottom">
        <div class="search-bar-local">
            <i class="fa-solid fa-magnifying-glass" style="font-size: 0.8rem;"></i>
            <input type="text" id="im-po-search-input-bottom" placeholder="New PO...">
        </div>
        <button id="im-po-search-button-bottom" type="button" style="margin-right: auto;">Search</button>

        <div class="form-buttons-container" style="gap: 5px; margin-top:0; padding-top:0; border:none;">
            <button type="button" id="im-add-invoice-button">Add</button>
            <button type="button" id="im-update-invoice-button" class="hidden">Update</button>
            <button type="button" id="im-clear-form-button" class="secondary-btn">Clear</button>
            <button type="button" id="im-back-to-active-task-button" class="secondary-btn hidden">Back</button>
        </div>
    </div>
</form>
        </div>

        <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 25px;">
            
            <div style="display: flex; gap: 20px; align-items: center; font-size: 0.9rem; color: #555;">
                
                <div style="white-space: nowrap;">
                    <strong style="color: #003A5C;">PO:</strong> 
                    <span class="im-po-no" style="font-weight: 600; color: #000;">---</span>
                </div>

                <div style="white-space: nowrap;">
                    <strong style="color: #003A5C;">Site:</strong> 
                    <span class="im-po-site" style="font-weight: 600; color: #000;">---</span>
                </div>

                <div style="white-space: nowrap; max-width: 300px; overflow: hidden; text-overflow: ellipsis;">
                    <strong style="color: #003A5C;">Vendor:</strong> 
                    <span class="im-po-vendor" style="font-weight: 600; color: #000;">---</span>
                </div>

            </div>

            <button type="button" class="modal-close-btn" style="margin: 0;">Close</button>
        </div>


    </div>
</div>

                    <div id="im-existing-invoices-container" class="hidden">
                         <hr class="section-divider">
                         <div id="im-po-details-container-duplicate" class="im-po-details-container hidden">
                            <div class="po-details-grid">
                               <p><strong>PO No:</strong> <span class="im-po-no"></span></p>
                               <p><strong>Site:</strong> <span class="im-po-site"></span></p>
                               <p><strong>PO Value:</strong> <span class="im-po-value"></span></p>
                               <p><strong>Vendor:</strong> <span class="im-po-vendor"></span></p>
                            </div>
                        </div>
                        <h2 id="existing-invoices-count-display">Existing Invoices (0)</h2>
                        <div class="table-wrapper">
                            <table>
                                <thead><tr><th>Inv Entry ID</th><th>Inv No.</th><th>Invoice Date</th><th>Inv Value</th><th>Amount To Paid</th><th>Status</th><th>Release Date</th><th>Actions</th></tr></thead>
                                <tbody id="im-invoices-table-body"></tbody>
                                <tfoot id="im-invoices-table-footer" style="background-color: #f8f9fa; font-weight: bold;"><tr><td colspan="3" style="text-align: right;">Total:</td><td id="im-invoices-total-value" style="text-align: left;">0.00</td><td id="im-invoices-total-paid" style="text-align: left;">0.00</td><td colspan="3"></td></tr></tfoot>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="im-batch-entry" class="workdesk-section hidden">
                    <h1>Batch Invoice Entry <span id="batch-count-display" class="table-count-display">(Total in Batch: 0)</span></h1>
                    <p>Add a new PO for a new invoice, or search for a PO to add existing invoices for bulk editing.</p>

                    <div id="im-batch-po-add-container" class="search-and-filter-group" style="margin-bottom: 20px;">
                        <input type="text" id="im-batch-po-input" placeholder="Enter PO or Status..." style="flex-grow: 1; margin-bottom: 0;">
                        <button id="im-batch-add-po-button" type="button">Add New PO</button>
                        <button id="im-batch-search-existing-button" type="button" class="secondary-btn">Search by PO</button>
                        <button id="im-batch-search-by-status-button" type="button" class="secondary-btn" style="background-color: #17a2b8;">Search by Status</button>
                        <div class="batch-note-search-wrapper"><select id="im-batch-note-search-select" placeholder="Search by Note..."></select></div>
                        <button id="im-batch-search-by-note-button" type="button" class="secondary-btn" style="background-color: #ffc107; color: #212529;">Search by Note</button>
                        <button id="im-batch-clear-button" type="button" class="secondary-btn" style="background-color: #dc3545;">Clear Batch</button>
                    </div>
                    <div id="im-batch-global-controls" class="search-and-filter-group" style="margin-bottom: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 6px;">
                        <div class="form-group" style="flex: 1; min-width: 200px; margin: 0;"><label for="im-batch-global-attention">Global Attention</label><select id="im-batch-global-attention"></select></div>
                        <div class="form-group" style="flex: 1; min-width: 150px; margin: 0;"><label for="im-batch-global-status">Global Status</label><select id="im-batch-global-status" class="batch-input" style="width: 100%; padding: 11px;"><option value="">(No Change)</option><option value="For SRV">For SRV</option><option value="Pending">Pending</option><option value="For IPC">For IPC</option><option value="Under Review">Under Review</option><option value="For Approval">For Approval</option><option value="CEO Approval">CEO Approval</option><option value="Report">Report</option><option value="With Accounts">With Accounts</option><option value="On Hold">On Hold</option><option value="CLOSED">CLOSED</option><option value="Cancelled">Cancelled</option></select></div>
                        <div class="form-group" style="flex: 1; min-width: 200px; margin: 0;"><label for="im-batch-global-note">Global Note</label><input type="text" id="im-batch-global-note" placeholder="Type note and press Enter..." class="batch-input" style="width: 100%;"></div>
                    </div>

                    <div class="table-wrapper" style="max-height: 50vh; overflow-y: auto;">
                        <table id="im-batch-entry-table">
                            <thead><tr><th>PO</th><th>Site</th><th>Vendor</th><th>Inv. No.</th><th>Inv. Name</th><th>SRV Name</th><th>Inv. Date</th><th>Inv. Value</th><th>Amount To Paid</th><th>Attention</th><th>Status</th><th>Note</th><th></th></tr></thead>
                            <tbody id="im-batch-table-body"></tbody>
                        </table>
                    </div>
                    <div class="form-buttons-container" style="justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <button id="im-refresh-batch-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i> Refresh Data</button>
                        <button id="im-batch-save-button" type="button" class="download-btn">Save All Invoices</button>
                    </div>
                </section>

                <section id="im-summary-note" class="workdesk-section hidden">
                    <h1>Summary Note Print <span id="summary-note-count-display" class="table-count-display"></span></h1>
                    <div id="summary-note-controls">
                        <div class="form-group">
                            <label for="summary-note-previous-input">Previous Note</label>
                            <input type="text" id="summary-note-previous-input" list="note-suggestions" placeholder="e.g., 1st Payment">
                        </div>
                        <div class="form-group">
                            <label for="summary-note-current-input">Current Note</label>
                            <input type="text" id="summary-note-current-input" list="note-suggestions" placeholder="e.g., 2nd Payment">
                        </div>
                        <div class="form-group">
                            <label for="summary-note-status-input">Set Status</label>
                            <select id="summary-note-status-input">
                                <option value="">(Keep Existing)</option>
                                <option value="For SRV">For SRV</option>
                                <option value="Pending">Pending</option>
                                <option value="For IPC">For IPC</option>
                                <option value="Under Review">Under Review</option>
				<option value="For Approval">For Approval</option>
                                <option value="CEO Approval">CEO Approval</option>
                                <option value="Report">Report</option>
                                <option value="With Accounts">With Accounts</option>
                                <option value="Original PO">Original PO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="summary-note-srv-input">Set SRV Name</label>
                            <input type="text" id="summary-note-srv-input" placeholder="Enter new SRV Name...">
                        </div>
                        <datalist id="note-suggestions"></datalist>

                        <div class="summary-button-row" style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; width: 100%; padding-top: 25px; border-top: 1px solid #eee;">

                            <div class="left-buttons" style="display: flex; gap: 10px;">
                                <button type="button" id="summary-note-generate-btn" style="background-color: #00748C; color: white;">Generate Summary</button>

                                <button type="button" id="summary-note-prev-pdf-btn" style="background-color: #6f42c1; color: white; border: none; border-radius: 4px; padding: 10px 15px; cursor: pointer; font-weight: bold;">
                                    <i class="fa-regular fa-file-pdf"></i> Prev Summary
                                </button>

                                <button type="button" id="summary-note-print-btn" class="print-btn" style="background-color: #17a2b8; color: white;">
                                    <i class="fa-solid fa-print"></i> Print Summary
                                </button>
                            </div>

                            <div class="right-buttons" style="display: flex; gap: 10px;">
                                <button type="button" id="summary-note-update-btn" class="secondary-btn" style="background-color: #6c757d; color: white;">Update Changes</button>

                                <button type="button" id="summary-note-clear-btn" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 10px 15px; cursor: pointer; font-weight: bold;">Clear</button>

                                <button type="button" id="im-refresh-summary-button" class="secondary-btn" style="background-color: #6c757d; color: white;" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i></button>
                            </div>

                        </div>
                    </div>

                    <div class="form-group no-print" style="margin-top: 20px;"><label for="summary-note-custom-notes-input">Custom Notes for Print:</label><textarea id="summary-note-custom-notes-input" rows="3" placeholder="Enter any specific remarks or instructions to appear on the printout..."></textarea></div>
                    <hr class="section-divider">

                    <div id="summary-note-printable-area" class="hidden">
                        <div class="sn-print-header">
                            <div class="sn-print-company">
                                <h2>ISMAIL BIN ALI TRADING & CONT. CO. W.L.L</h2>
                                <div class="sn-qr-container" style="margin-top: 5px; text-align: left;">
                                    <div id="sn-prev-summary-qr"></div>
                                    <p style="font-size: 8pt; margin: 3px 0 0 0; font-weight: bold;">Prev Summary</p>
                                </div>
                            </div>
                            <div class="sn-print-title">
                                <h1>PAYMENT SUMMARY</h1>
                                <p id="sn-date">Date: --/--/----</p>
                            </div>
                        </div>

                        <div class="sn-vendor-info"><div class="sn-vendor-summary-title"><p><strong>Summary for :</strong> <span id="sn-vendor-name"></span></p></div></div>
                        <div class="sn-payment-details"><div><strong>Previous Payment:</strong> <span id="sn-previous-payment"></span></div><div><strong>Current Payment:</strong> <span id="sn-current-payment"></span></div></div>
                        <table class="sn-table"><thead><tr><th>Inv S/N</th><th>P.O.No.</th><th>Site</th><th>Bill Description</th><th>Bill Date</th><th>Payment Amount</th></tr></thead><tbody id="sn-table-body"></tbody></table>
                        <div class="sn-footer"><span>Total Current Payment</span><span id="sn-total-in-words"></span><span id="sn-total-numeric"></span></div>
                        <div id="sn-print-notes" class="sn-print-notes-section"><h4>Notes:</h4><div id="sn-print-notes-content" style="white-space: pre-wrap;"></div></div>
                        <div class="sn-signatures"><div>Prepared By</div><div>CEO</div></div>
                    </div>
                </section>

                <section id="im-reporting" class="workdesk-section hidden">
                    <div class="report-header">
                        <h1>Invoice Records <span id="reporting-count-display" class="table-count-display"></span></h1>
                        <button id="im-mobile-search-btn" class="im-mobile-search-btn" type="button"><i class="fa-solid fa-magnifying-glass"></i></button>
                        <div class="daily-report-section">
                           <input type="date" id="im-daily-report-date" title="Select a date for the daily report">
                           <button id="im-download-daily-report-button" class="download-btn" type="button"><i class="fa-solid fa-calendar-day"></i> Daily Entry Report</button>
                           <button id="im-download-with-accounts-report-button" class="download-btn" type="button"><i class="fa-solid fa-file-invoice-dollar"></i> With Accounts Report</button>
                        </div>
                    </div>

                    <div id="im-mobile-search-modal" class="modal-overlay hidden">
                        <div class="modal-container im-search-modal-container">
                            <div class="modal-header"><h2>Search Report</h2><button class="modal-close-btn" data-modal-id="im-mobile-search-modal">&times;</button></div>
                            <div class="modal-content">
                                <form id="im-mobile-search-form">
                                    <div class="form-group"><label for="im-mobile-search-term">PO or Vendor</label><input type="text" id="im-mobile-search-term" placeholder="Enter PO or Vendor..."></div>
                                    <div class="form-group"><label for="im-mobile-site-filter">Site</label><select id="im-mobile-site-filter" name="site-filter"><option value="">All Sites</option></select></div>
                                    <div class="form-group">
                                        <label for="im-mobile-status-filter">Status</label>
                                        <select id="im-mobile-status-filter" name="status-filter">
                                        <option value="">All Statuses</option>
					<option value="For SRV">For SRV</option>
					<option value="Pending">Pending</option>
					<option value="For IPC">For IPC</option>
					<option value="Under Review">Under Review</option>
					<option value="For Approval">For Approval</option>
					<option value="CEO Approval">CEO Approval</option>
					<option value="Report">Report</option>
					<option value="With Accounts">With Accounts</option>
					<option value="On Hold">On Hold</option>
					<option value="CLOSED">CLOSED</option>
					<option value="Cancelled">Cancelled</option>
					<option value="Paid">Paid</option>
					<option value="Original PO">Original PO</option>
					<option value="Epicore Value">Epicore Value</option>
				      </select>
                                    </div>
                                    <div class="form-group"><label for="im-mobile-date-filter">Release Month</label><input type="month" id="im-mobile-date-filter" title="Filter by Release Month"></div>
                                </form>
                            </div>
                            <div class="modal-footer" style="justify-content: space-between;">
                                <button id="im-mobile-search-clear-btn" type="button" class="secondary-btn">Clear</button>
                                <button id="im-mobile-search-run-btn" type="button">Search</button>
                            </div>
                        </div>
                    </div>

                    <div class="reporting-legend">
                        <div class="legend-item"><span class="legend-color" style="background-color: #d9eef2;"></span> Partially Paid</div>
                        <div class="legend-item"><span class="legend-color" style="background-color: #f7f3d9;"></span> Fully Paid</div>
                    </div>
                    <form id="im-reporting-form" class="report-controls">
                        <div class="search-and-filter-group">
                            <div class="search-bar-local"><i class="fa-solid fa-magnifying-glass"></i><input type="text" id="im-reporting-search" placeholder="Search by PO or Vendor..."></div>
                            <select id="im-reporting-site-filter" name="site-filter"><option value="">All Sites</option></select>
                            <select id="im-reporting-status-filter" name="status-filter">
                                <option value="">All Statuses</option>
				<option value="Negative Balance" style="color: red; font-weight: bold;">Negative Balance (Errors)</option>
				<option value="For SRV">For SRV</option>
				<option value="Pending">Pending</option>
				<option value="For IPC">For IPC</option>
				<option value="Under Review">Under Review</option>
				<option value="For Approval">For Approval</option>
				<option value="CEO Approval">CEO Approval</option>
				<option value="Report">Report</option>
				<option value="With Accounts">With Accounts</option>
				<option value="On Hold">On Hold</option>
				<option value="CLOSED">CLOSED</option>
				<option value="Cancelled">Cancelled</option>
				<option value="Paid">Paid</option>
				<option value="Original PO">Original PO</option>
				<option value="Epicore Value">Epicore Value</option>
				<option value="Approved">Approved</option>
				<option value="Rejected">Rejected</option>
                            </select>
                            <input type="month" id="im-reporting-date-filter" title="Filter by Release Month">
                        </div>
                        <div class="report-buttons-group">
                            <button type="submit">Search</button>
                            <button id="im-reporting-clear-button" class="secondary-btn" type="button">Clear</button>
                            <button id="im-refresh-reporting-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i> Refresh Data</button>
                            <button id="im-reporting-print-btn" class="print-btn" type="button"><i class="fa-solid fa-print"></i> Print Report</button>
                            <button id="im-reporting-download-csv-button" class="download-btn" type="button"><i class="fa-solid fa-download"></i> Download Full Report</button>
                        </div>
                    </form>

                    <div id="im-mobile-legend" class="im-mobile-legend">
                        <div class="legend-item"><span class="legend-color-dot" style="background: linear-gradient(135deg, #28a745, #1e7e34);"></span> Close</div>
                        <div class="legend-item"><span class="legend-color-dot" style="background: linear-gradient(135deg, var(--iba-secondary-periwinkle), #3b71c4);"></span> Open</div>
                        <div class="legend-item"><span class="legend-color-dot" style="background: linear-gradient(135deg, var(--iba-secondary-gold), #8a7300);"></span> New</div>
                        <div class="legend-item"><span class="legend-color-dot" style="background: linear-gradient(135deg, var(--iba-secondary-terracotta), #a24227);"></span> Pending</div>
                    </div>
                    <div id="im-reporting-content" class="table-wrapper"><p>Enter a search term and click Search to load data.</p></div>
                    <div id="im-reporting-mobile-view"></div>
                </section>

                <section id="im-payments" class="workdesk-section hidden">
                    <h1>Process Payments <span id="payments-count-display" class="table-count-display"></span></h1>
                    <p>Add invoices with status "With Accounts" to process payments.</p>
                     <div class="form-buttons-container" style="justify-content: flex-start; margin-bottom: 20px;">
                        <button type="button" id="im-add-payment-button"><i class="fa-solid fa-plus"></i> Add Invoice for Payment</button>
                    </div>
                     <div class="table-wrapper"><table id="im-payments-table"><thead><tr><th>PO</th><th>Site</th><th>Vendor</th><th>Inv. Entry</th><th>Inv. Value</th><th>Amount To Paid</th><th>Release Date</th><th>Status</th><th></th></tr></thead><tbody id="im-payments-table-body"></tbody></table></div>
                    <div class="form-buttons-container" style="justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <button id="im-save-payments-button" type="button" class="download-btn"><i class="fa-solid fa-save"></i> Save All Payments as Paid</button>
                    </div>
                </section>

                <section id="im-finance-report" class="workdesk-section hidden">
                    <h1>Finance Report (Read-Only) <span id="finance-report-count-display" class="table-count-display"></span></h1>
                    <p>Search for payments from the finance database. This is a read-only view.</p>
                    <div class="search-and-filter-group" style="max-width: 600px; margin-bottom: 20px;">
                        <div class="search-bar-local" style="margin-bottom: 0;">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="im-finance-search-po" placeholder="Enter PO No. to search...">
                        </div>
                        <button class="form-buttons-container" id="im-finance-search-btn" type="button">Search</button>
                        <button class="form-buttons-container secondary-btn" id="im-finance-clear-btn" type="button">Clear</button>
                    </div>
                    <div id="im-finance-results" style="display: none;">
                        <div class="form-container" style="padding:0; box-shadow: none; background: none;">
                            <div id="im-finance-no-results" style="display: none; padding: 15px; background-color: #fff3cd; border-radius: 6px;">No payments found for this PO No.</div>
                            <div id="im-finance-results-body"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div id="vacation-replacement-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header"><h2 id="vacation-modal-title">Attention: User on Vacation</h2><button class="modal-close-btn" data-modal-id="vacation-replacement-modal">&times;</button></div>
            <div class="modal-content">
                <p>The person you selected, <strong id="vacationing-user-name">User</strong>, is currently on vacation.</p>
                <p>They are scheduled to return on: <strong id="vacation-return-date">Date</strong>.</p>
                <p style="font-weight: bold; margin-top: 20px;">Please contact their designated replacement for this task:</p>
                <ul style="list-style: none; padding-left: 0; background-color: #f4f7fa; padding: 15px; border-radius: 4px;">
                    <li><strong>Name:</strong> <span id="replacement-name-display"></span></li>
                    <li><strong>Contact No:</strong> <span id="replacement-contact-display"></span></li>
                    <li><strong>Email:</strong> <span id="replacement-email-display"></span></li>
                </ul>
                <p style="margin-top: 20px;">You can close this window and select a different user, or proceed to contact the replacement.</p>
            </div>
            <div class="modal-footer"><button class="secondary-btn modal-close-btn" data-modal-id="vacation-replacement-modal">Close</button></div>
        </div>
    </div>

    <div id="calendar-task-modal" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 450px;">
            <div class="modal-header"><h2>Active Tasks Found</h2><button class="modal-close-btn" data-modal-id="calendar-task-modal">&times;</button></div>
            <div class="modal-content">
                <p>You have <strong id="calendar-modal-task-count">0</strong> active task(s) on <strong id="calendar-modal-task-date">this date</strong>.</p>
                <p style="margin-top: 20px;">Would you like to go to the "Active Task" section to view them?</p>
            </div>
            <div class="modal-footer"><button class="secondary-btn modal-close-btn" data-modal-id="calendar-task-modal">Cancel</button><button id="calendar-modal-view-tasks-btn" type="button">View Tasks</button></div>
        </div>
    </div>

    <div id="modify-task-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header"><h2 id="modify-task-title">Modify Task</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-content">
                <form id="modify-task-form">
                    <input type="hidden" id="modify-task-key"><input type="hidden" id="modify-task-source"><input type="hidden" id="modify-task-originalPO"><input type="hidden" id="modify-task-originalKey"><input type="hidden" id="modify-task-originalAttention">
                    <div class="form-group"><label for="modify-task-attention">Attention</label><select id="modify-task-attention" name="attention"></select></div>
                    <div class="form-group">
                        <label for="modify-task-status">Status</label>
                        <select id="modify-task-status" name="status">
                            <option value="" disabled selected>Select new status...</option>
                            <option value="For SRV">For SRV</option><option value="Pending Signature">Pending Signature</option><option value="For IPC">For IPC</option><option value="Report">Report (Keep Active)</option>
                            <option value="Report Done">Report Done (Complete)</option><option value="PO Found">PO Found (Complete)</option><option value="PO Not Found">PO Not Found (Complete)</option><option value="Other">Other (Specify)</option>
                        </select>
                    </div>
                    <div id="modify-task-status-other-container" class="form-group hidden"><label for="modify-task-status-other">Custom Status</label><input type="text" id="modify-task-status-other" placeholder="Enter custom status"></div>
                    <div class="form-group"><label for="modify-task-note">Note / Instruction</label><textarea id="modify-task-note" name="note" rows="3"></textarea></div>
                </form>
            </div>
            <div class="modal-footer"><button class="secondary-btn modal-close-btn">Cancel</button><button id="modify-task-save-btn" type="button">Save Changes</button></div>
        </div>
    </div>

    <div id="im-batch-search-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header"><h2>Search and Add Existing Invoices</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-content">
                <div class="search-and-filter-group" style="margin-bottom: 15px;"><input type="text" id="im-batch-modal-po-input" placeholder="Enter PO to Search..." style="flex-grow: 1;"><button id="im-batch-modal-search-btn">Search</button></div>
                <div id="im-batch-modal-results" class="table-wrapper" style="max-height: 40vh; overflow-y: auto;"><p>Enter a PO number to see existing invoices.</p></div>
            </div>
            <div class="modal-footer"><button id="im-batch-modal-add-selected-btn" class="download-btn">Add Selected to Batch</button><button class="secondary-btn modal-close-btn">Cancel</button></div>
        </div>
    </div>

    <div id="im-add-payment-modal" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 700px;">
            <div class="modal-header"><h2>Add Invoices for Payment</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-content">
                <p>Search for a PO to find invoices with status "With Accounts".</p>
                <div class="search-and-filter-group" style="margin-bottom: 15px;"><input type="text" id="im-payment-modal-po-input" placeholder="Enter PO to Search..." style="flex-grow: 1;"><button id="im-payment-modal-search-btn">Search PO</button></div>
                <div id="im-payment-modal-results" class="table-wrapper" style="max-height: 40vh; overflow-y: auto;"><p>Enter a PO number to see invoices ready for payment.</p></div>
            </div>
            <div class="modal-footer" style="justify-content: space-between; align-items: center;">
                <div style="font-weight: bold; font-size: 1.1rem; color: #333;">
                    Selected Total: <span id="payment-modal-total-value" style="color: #003A5C;">0.00</span>
                </div>


                <div style="display: flex; gap: 10px;">
                    <button id="im-payment-modal-add-selected-btn" class="download-btn"><i class="fa-solid fa-plus"></i> Add Selected</button>
                    <button class="secondary-btn modal-close-btn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="im-manual-po-modal" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Add New PO (Manual)</h2>
                <button class="modal-close-btn" onclick="document.getElementById('im-manual-po-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">
                    This PO was not found in the database. Please enter its details manually to proceed.
                </p>
                <form id="im-manual-po-form">
                    <div class="form-group">
                        <label>PO Number</label>
                        <input type="text" id="manual-po-number" readonly style="background-color: #eee;">
                    </div>
                    <div class="form-group">
                        <label>Supplier ID</label>
                        <input type="text" id="manual-supplier-id" placeholder="Enter ID to search vendor...">
                    </div>
                    <div class="form-group">
                        <label>Vendor Name</label>
                        <input type="text" id="manual-vendor-name" readonly placeholder="Vendor will appear here..." style="background-color: #f9f9f9;">
                    </div>
                    <div class="form-group">
                        <label>Site / Project</label>
                        <select id="manual-site-select">
                            <option value="">Select Site...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Total PO Value</label>
                        <input type="number" id="manual-po-amount" step="0.01" placeholder="0.00">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn modal-close-btn" onclick="document.getElementById('im-manual-po-modal').classList.add('hidden')">Cancel</button>
                <button id="im-save-manual-po-btn" class="download-btn">Save & Continue</button>
            </div>
        </div>
    </div>

    <div id="im-finance-report-modal" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 900px;">
            <div class="modal-header"><h2>Payment Certificate</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-content" style="max-height: 70vh; overflow-y: auto;">
                <div id="im-finance-report-printable-area">
                    <div class="report-header"><h3>IBA</h3><h4>Ø´Ø±ÙƒØ©/Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø¨Ù† Ø¹Ù„ÙŠ Ù„Ù„ØªØ¬Ø§Ø±Ø© ÙˆØ§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</h4><h4>ISMAIL BIN ALITRADING & CONT. CO. W.L. L</h4></div>
                    <div class="report-details">
                        <div class="report-details-col"><p><strong>Date:</strong> <span id="im-reportDate"></span></p><p><strong>LPO No:</strong> <span id="im-reportPoNo"></span></p><p><strong>Project:</strong> <span id="im-reportProject"></span></p></div>
                        <div class="report-details-col"><p><strong>Vendor No:</strong> <span id="im-reportVendorId"></span></p><p><strong>Vendor Name:</strong> <span id="im-reportVendorName"></span></p><p><strong>Total PO Value:</strong> <span id="im-reportTotalPoValue"></span></p></div>
                    </div>
                    <div class="report-summary">
                        <div class="report-summary-col"><p><strong>Total Certificate Cost:</strong> <span id="im-reportTotalCertified"></span></p><p><strong>Total Previous Payment:</strong> <span id="im-reportTotalPrevPayment"></span></p></div>
                        <div class="report-summary-col"><p><strong>Total Commited Cost:</strong> <span id="im-reportTotalCommitted"></span></p><p><strong>Total Retention To Date:</strong> <span id="im-reportTotalRetention"></span></p></div>
                    </div>
                    <div class="table-wrapper">
                        <table class="nested-invoice-table" style="border: 1px solid #dee2e6;">
                            <thead style="background-color: #343a40; color: white;"><tr><th>P/N</th><th>Cheque No.</th><th>CERTIFIED AMOUNT</th><th>RETENTION</th><th>PAYMENT</th><th>DATE PAID</th></tr></thead>
                            <tbody id="im-reportTableBody"></tbody>
                            <tfoot><tr style="background-color: #e9ecef; font-weight: bold;"><td colspan="2" style="text-align: right;">Total Payment:</td><td id="im-reportTotalCertifiedAmount" style="text-align: right; font-family: monospace; padding-right: 15px;"></td><td id="im-reportTotalRetentionAmount" style="text-align: right; font-family: monospace; padding-right: 15px;"></td><td id="im-reportTotalPaymentAmount" style="text-align: right; font-family: monospace; padding-right: 15px;"></td><td></td></tr></tfoot>
                        </table>
                    </div>
                    <div class="signatures" style="display: flex; justify-content: space-between; margin-top: 60px; padding-top: 20px;">
                        <div class="signature-box" style="text-align: center; width: 30%;"><p>Prepared By</p><div class="signature-line" style="border-top: 1px solid #000; margin-top: 40px; padding-top: 10px; display: inline-block; width: 80%;"></div></div>
                        <div class="signature-box" style="text-align: center; width: 30%;"><p>Finance</p><div class="signature-line" style="border-top: 1px solid #000; margin-top: 40px; padding-top: 10px; display: inline-block; width: 80%;"></div></div>
                        <div class="signature-box" style="text-align: center; width: 30%;"><p>CEO</p><div class="signature-line" style="border-top: 1px solid #000; margin-top: 40px; padding-top: 10px; display: inline-block; width: 80%;"></div></div>
                    </div>
                    <div id="im-reportNotesSection" style="display: none; margin-top: 40px;"><h5 style="font-weight: bold;">Notes:</h5><div id="im-reportNotesContent" style="white-space: pre-wrap; font-size: 12pt; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; border-radius: 5px; min-height: 50px;"></div></div>
                </div>
            </div>
            <div class="modal-footer"><button class="secondary-btn modal-close-btn">Close</button><button class="print-btn" id="im-finance-print-report-btn"><i class="fa-solid fa-print"></i> Print Report</button></div>
        </div>
    </div>


    <div id="ceo-approval-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header"><h2>Make Approval</h2><button class="modal-close-btn">&times;</button></div>
            <div class="modal-content">
                <form id="ceo-approval-form">
                    <input type="hidden" id="ceo-modal-key"><input type="hidden" id="ceo-modal-source"><input type="hidden" id="ceo-modal-originalPO"><input type="hidden" id="ceo-modal-originalKey">
                    <div id="ceo-modal-details" style="background: #f4f7fa; padding: 15px; border-radius: 4px; margin-bottom: 20px; line-height: 1.6;"></div>
                    <div class="form-group"><label for="ceo-modal-amount">Amount to be Paid</label><input type="number" id="ceo-modal-amount" step="0.01" placeholder="0.00" required></div>
                    <div class="form-group"><label for="ceo-modal-note">Note / Remark</label><textarea id="ceo-modal-note" name="note" rows="3" placeholder="Add an optional note..."></textarea></div>
                </form>
            </div>
            <div class="modal-footer" style="justify-content: space-between;"><button id="ceo-modal-reject-btn" type="button" class="delete-btn">Reject</button><button id="ceo-modal-approve-btn" type="button" class="download-btn" style="background-color: #28a745;">Approve</button></div>
        </div>
    </div>

    <div id="history-modal" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Invoice Status History</h2>
                <button class="modal-close-btn" onclick="document.getElementById('history-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-content">
                <div id="history-modal-loader" class="hidden" style="text-align: center; padding: 20px;">Loading...</div>
                <div class="table-wrapper">
                    <table id="history-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Date & Time</th>
                                <th>Updated By</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn modal-close-btn" onclick="document.getElementById('history-modal').classList.add('hidden')">Close</button>
            </div>
        </div>
    </div>

<div id="ms-new-material-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="ms-modal-title">Register New Product</h2>
                <button class="modal-close-btn" onclick="document.getElementById('ms-new-material-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-content">
                <form id="ms-new-material-form">

                    <div id="ms-type-container" class="form-group">
                        <label>Item Type</label>
                        <select id="ms-new-type" style="background-color: #f0f8ff; border: 1px solid #00748C; font-weight: bold; width: 100%; padding: 10px;">
                            <option value="Bulk">Bulk (Tiles, Cement, etc.)</option>
                            <option value="Serialized">Serialized (Drill, Grinder, etc.)</option>
                        </select>
                    </div>

                    <div id="ms-id-search-group" class="form-group">
                        <label>Product ID / Name Search</label>
                        <select id="ms-new-id" placeholder="Type ID or Name..."></select>
                    </div>

                    <div class="form-group">
        <label>Category</label>
        <input type="text" id="ms-new-category" list="ms-category-list" placeholder="e.g. Tools, Equipment, Safety" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
        <datalist id="ms-category-list">
            <option value="Tools">
            <option value="Equipment">
            <option value="Consumables">
            <option value="Safety">
            <option value="Materials">
        </datalist>
    </div>

                    <div id="ms-id-display-group" class="form-group hidden">
                        <label>Product ID</label>
                        <input type="text" id="ms-edit-id-display" readonly style="background-color: #e9ecef; color: #555; font-weight: bold; cursor: not-allowed;">
                    </div>

                    <div class="form-group">
                        <label>Product Name</label>
                        <input type="text" id="ms-new-name" placeholder="Enter Product Name" required>
                    </div>

                    <div id="ms-serial-container" class="form-group hidden" style="border: 1px dashed #00748C; padding: 10px; background: #e0f7fa; border-radius: 4px;">
                        <label style="color: #00748C;">Serial Number</label>
                        <input type="text" id="ms-new-serial" placeholder="Enter Serial No. (e.g., SN-12345)" style="background: #fff;">
                    </div>

                    <div class="form-group">
                        <label>Details</label>
                        <input type="text" id="ms-new-details" placeholder="Description / Size / Unit">
                    </div>

                    <div class="form-group">
                        <label>Status</label>
                        <select id="ms-new-status" style="width: 100%; padding: 10px;">
                            <option value="Active">Active</option>
                            <option value="Broken">Broken</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>

                    <div id="ms-stock-entry-row" style="display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                        <div class="form-group" style="flex: 60%;">
                            <label>Opening Stock Site</label>
                            <select id="ms-new-site-select" style="background-color: #fff; border: 1px solid #ccc; height: 45px; width: 100%;">
                                <option value="Main Store">Main Store</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 40%;">
                            <label>Quantity</label>
                            <input type="number" id="ms-new-stock-qty" placeholder="0" step="any" style="height: 45px;">
                        </div>
                    </div>

                </form>
            </div>

            <div class="modal-footer" style="justify-content: space-between;">
                <button type="button" id="ms-clear-form-btn" class="secondary-btn" style="background-color: #ffc107; color: #212529; border: none;">Clear</button>
                <div style="display: flex; gap: 10px;">
                    <button class="secondary-btn modal-close-btn" onclick="document.getElementById('ms-new-material-modal').classList.add('hidden')">Cancel</button>
                    <button id="ms-save-new-btn" type="button" class="download-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ms-add-stock-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Add / Adjust Stock</h2>
                <button class="modal-close-btn" onclick="document.getElementById('ms-add-stock-modal').classList.add('hidden')">&times;</button>
            </div>
            <div class="modal-content">
                <input type="hidden" id="ms-add-key"> <div class="form-group">
                    <label>Product ID</label>
                    <input type="text" id="ms-add-id" readonly style="background-color: #eee;">
                </div>
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="ms-add-name" readonly style="background-color: #eee;">
                </div>
                <div class="form-group">
                    <label>Details</label>
                    <input type="text" id="ms-add-details" readonly style="background-color: #eee;">
                </div>

                <div class="form-group" style="margin-top: 10px;">
                    <label>Target Site / Store</label>
                    <select id="ms-add-site-select" style="background-color: #fff; font-weight: bold; border: 1px solid #00748C;">
                        <option value="Main Store">Main Store</option>
                        </select>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc;">
                    <div class="form-group" style="flex: 1;">
                        <label>Global Total</label>
                        <input type="number" id="ms-add-current-stock" readonly style="background-color: #f9f9f9; font-weight: bold;">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label style="color: #28a745;">+/- Adjust QTY</label>
                        <input type="number" id="ms-add-qty-input" placeholder="Enter QTY" class="highlight-field" step="any">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn modal-close-btn" onclick="document.getElementById('ms-add-stock-modal').classList.add('hidden')">Cancel</button>
                <button id="ms-save-stock-btn" type="button" class="download-btn"><i class="fa-solid fa-plus"></i> Update Stock</button>
            </div>
        </div>
    </div>


<div id="transfer-job-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="transfer-job-modal-title">New Transaction</h2>
                <button class="modal-close-btn" onclick="closeTransferModal()">&times;</button>
            </div>

<div class="modal-content">

    <div style="display: flex; gap: 20px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
        <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
            <input type="radio" name="tf-mode" value="single" checked onchange="toggleTransferMode('single')">
            <strong>Single Item</strong>
        </label>
        <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
            <input type="radio" name="tf-mode" value="multi" onchange="toggleTransferMode('multi')">
            <strong>Multi-Item Batch</strong>
        </label>
    </div>

    <form id="transfer-job-form">
        <div class="transfer-2col-grid">
            <div class="transfer-col">
                <div class="form-group"><label>Job Type</label><input type="text" id="tf-job-type" readonly style="font-weight: bold; color: #003A5C;"></div>
                <div class="form-group"><label>Control Number</label><input type="text" id="tf-control-no" readonly style="background-color: #e9ecef; font-weight: bold;"></div>

                <div class="form-group">
    <label>
        Product Search
        <i class="fa-solid fa-sync" id="tf-refresh-stock-btn" style="cursor:pointer; color:#28a745; margin-left:8px;" title="Click to Refresh Stock Availability"></i>
    </label>
    <select id="tf-product-select"></select>
</div>
                <div class="form-group"><label>Product Name</label><input type="text" id="tf-product-name" readonly></div>
                <div class="form-group"><label>Details</label><input type="text" id="tf-details" readonly></div>

                <div class="form-group"><label>Requestor</label><input type="text" id="tf-requestor" readonly></div>
            </div>

            <div class="transfer-col">
                <div style="display: flex; gap: 8px;">
                    <div class="form-group" style="flex: 1;"><label>Shipping Date</label><input type="date" id="tf-shipping-date"></div>
                    <div class="form-group" style="flex: 1;"><label>Arrival Date</label><input type="date" id="tf-arrival-date"></div>
                </div>

                <div class="form-group">
                    <label style="color: #00748C;">Required Quantity</label>
                    <input type="number" id="tf-req-qty" step="any" style="background-color: #f0fbff; border-color: #00748C; font-weight: bold;">
                </div>

                <button type="button" id="tf-add-to-list-btn" class="hidden" style="width: 100%; background-color: #ffc107; color: #000; border: none; padding: 8px; border-radius: 4px; font-weight: bold; margin-bottom: 10px; cursor: pointer;">
                    <i class="fa-solid fa-plus"></i> Add Item to Batch
                </button>

                <div class="form-group"><label>From (Source Site)</label><select id="tf-from"></select></div>
                <div class="form-group"><label style="color: #d39e00; font-weight: bold;">Source Site Contact (Step 1)</label><select id="tf-source-contact"></select></div>
                <div class="form-group"><label>Approver / Admin (Step 2)</label><select id="tf-approver"></select></div>
                <div class="form-group"><label>To (Destination Site)</label><select id="tf-to"></select></div>
                <div class="form-group"><label>Receiver (Step 3)</label><select id="tf-receiver"></select></div>

                <div class="form-group"><label>Status</label><select id="tf-status"><option value="Pending Source">Pending Source</option><option value="Pending Admin">Pending Admin</option><option value="In Transit">In Transit</option><option value="Completed">Completed</option><option value="Cancelled">Cancelled</option><option value="Rejected">Rejected</option></select></div>
                <div class="form-group"><label>Remarks</label><textarea id="tf-remarks" rows="1"></textarea></div>
            </div>
        </div>
    </form>

    <div id="tf-multi-list-container" class="hidden" style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 10px;">
        <h4 style="margin: 0 0 10px 0; font-size: 1rem; color: #333;">Batch Items (<span id="tf-batch-count">0</span>)</h4>
        <div class="table-wrapper" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
            <table id="tf-batch-table" style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                <thead style="background: #f8f9fa; position: sticky; top: 0;">
                    <tr>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #ddd;">Product Name</th>
                        <th style="padding: 8px; text-align: center; border-bottom: 1px solid #ddd;">Qty</th>
                        <th style="padding: 8px; text-align: center; border-bottom: 1px solid #ddd;">Action</th>
                    </tr>
                </thead>
                <tbody id="tf-batch-table-body" style="background: white;">
                    </tbody>
            </table>
        </div>
    </div>
</div>

            <div class="modal-footer" style="justify-content: flex-end;">
                <div style="display: flex; gap: 10px;">
                    <button class="secondary-btn modal-close-btn" onclick="closeTransferModal()" type="button">Cancel</button>
                    <button id="tf-save-btn" class="download-btn" type="button">Save Transaction</button>
                </div>
            </div>
        </div>
    </div>
    <div id="transfer-approval-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="transfer-approval-modal-title">Transfer Action</h2>
                <button class="modal-close-btn" onclick="document.getElementById('transfer-approval-modal').classList.add('hidden')">&times;</button>
            </div>

            <div class="modal-content">
                <input type="hidden" id="transfer-modal-key">
                <div id="transfer-modal-details" style="background: #f4f7fa; padding: 15px; border-radius: 4px; margin-bottom: 20px; line-height: 1.6;"></div>
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex: 1;"><label>Confirmed Quantity</label><input type="number" id="transfer-modal-qty" step="any"></div>
                    <div class="form-group hidden" id="transfer-modal-date-container" style="flex: 1;"><label style="color: #28a745; font-weight: bold;">Arrival Date</label><input type="date" id="transfer-modal-date" style="border: 2px solid #28a745; background-color: #f0fff4;"></div>
                </div>
                <div class="form-group"><label>Note / Remark</label><textarea id="transfer-modal-note" rows="3" placeholder="Add a note..."></textarea></div>
            </div>

            <div class="modal-footer" style="justify-content: space-between;">
                <button id="transfer-modal-reject-btn" class="delete-btn">Reject</button>
                <button id="transfer-modal-approve-btn" class="download-btn" style="background-color: #28a745;">Approve</button>
            </div>
        </div>
    </div>

<div id="standard-job-modal" class="modal-overlay hidden">
    <div class="modal-container">
        <div class="modal-header">
            <h2 id="standard-modal-title">Add New Job Entry</h2>
            <button class="modal-close-btn" onclick="closeStandardJobModal()">&times;</button>
        </div>

        <div class="modal-content">


<form id="jobentry-form">
    <div class="transfer-2col-grid">

        <div class="transfer-col">
            <div class="form-group">
                <label>Job Type</label>
                <select id="job-for" name="for" required onchange="toggleJobOtherInput()">
                    <option value="" disabled selected>Select a Type</option>
                    <option value="PR">PR</option>
                    <option value="Invoice">Invoice</option>
                    <option value="IPC">IPC</option>
                    <option value="Trip">Trip</option>
                    <option value="Payment">Payment</option>
                    <option value="Report">Report</option>
                    <option value="Transfer" style="color: #00748C; font-weight: bold;">&#8644; Transfer Stock</option>
                    <option value="Restock" style="color: #28a745; font-weight: bold;">&#43; Restock</option>
                    <option value="Return" style="color: #dc3545; font-weight: bold;">&#8617; Return</option>
                    <option value="Usage" style="color: #6f42c1; font-weight: bold;">&#10003; Usage</option>
                    <option value="Other" style="font-weight: bold;">-- Other (Specify) --</option>
                </select>
                <input type="text" id="job-other-specify" class="hidden" placeholder="Type Job Name..." style="margin-top: 5px;">
            </div>

            <div class="form-group">
                <label>Reference</label>
                <input type="text" id="job-ref" name="ref" placeholder="Ref No.">
            </div>

            <div class="form-group">
                <label>PO Number</label>
                <input type="text" id="job-po" name="po" placeholder="PO Number">
            </div>

            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="job-amount" name="amount" placeholder="0.00" step="0.01">
            </div>

            <div class="form-group" style="background: #f8f9fa; padding: 5px 10px; border-radius: 4px; border: 1px dashed #ccc; margin-bottom: 0 !important;">
                <label id="job-attachment-label" title="Click to open SharePoint" style="font-size: 0.8rem; margin-bottom: 3px; cursor: pointer; color: #00748C; transition: color 0.2s;">
                    <i class="fa-solid fa-paperclip"></i> Attachment <span style="font-weight: normal; color: #666; font-size: 0.75rem;">(Click here to Upload)</span>
                </label>

                <div style="display: flex; gap: 5px; align-items: center;">
                    <input type="text" id="job-attachment" name="attachmentName" placeholder="Paste filename..." style="margin-bottom: 0;">

                    <button type="button" id="job-attachment-view-btn" class="secondary-btn" title="View File" style="background-color: #6f42c1; color: white; border: none; border-radius: 4px; padding: 0;">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>
        </div> <div class="transfer-col">
            <div class="form-group">
                <label>Site / Project No.</label>
                <select id="job-site" name="site"></select>
            </div>

            <div class="form-group">
                <label>Group</label>
                <select id="job-group" name="group">
                    <option value="" disabled selected>Select Group</option>
                    <option value="Civil">Civil</option>
                    <option value="MEP">MEP</option>
                    <option value="Logistic">Logistic</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Attention</label>
                <select id="job-attention" name="attention"></select>
            </div>

            <div class="form-group">
                <label>Status</label>
                <input type="text" id="job-status" name="status" list="job-status-options" placeholder="Pending">
                <datalist id="job-status-options">
		    <option value="IPC Process"></option>
		    <option value="IPC Approval"></option>
		    <option value="IPC Ready"></option>
                    <option value="PO Request"></option>
                    <option value="Waiting For Approval"></option>
                    <option value="Under Review"></option>
                    <option value="On Hold"></option>
                </datalist>
            </div>

            <input type="hidden" id="job-date" name="date">
        </div>

    </div>
</form>

<div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">

    <div style="display: flex; gap: 10px;">
        <button type="button" id="add-job-button" class="download-btn" style="background-color: #28a745;">Add</button>

        <button type="button" id="update-job-button" class="download-btn hidden" style="background-color: #28a745;">Update Job</button>

        <button type="button" id="delete-job-button" class="delete-btn hidden" style="background-color: #C3502F;">Delete</button>

        <button type="button" id="clear-job-button" class="secondary-btn">Clear</button>
    </div>

    <button type="button" class="secondary-btn modal-close-btn" onclick="closeStandardJobModal()">Cancel</button>
</div>
    </div>
</div>


    <div id="im-reporting-printable-area" class="hidden">
        <header class="print-header"><div class="print-logo"><h1>ISMAIL BIN ALI TRADING & CONT. CO. W.L.L</h1></div>
        <div class="print-title-section">
        <h2 id="im-print-report-title">Invoice Summary Report</h2><p id="im-print-report-date"></p></div></header>
        <section class="print-summary">
            <h3>Report Summary</h3>
            <div class="print-summary-grid">
                <div><span>Total POs in Report</span><strong id="im-print-report-summary-pos">0</strong></div>
                <div><span>Total PO Value</span><strong id="im-print-report-summary-value">QAR 0.00</strong></div>
                <div><span>Total Amount Paid</span><strong id="im-print-report-summary-paid">QAR 0.00</strong></div>
            </div>
        </section>
        <section id="im-print-report-body"></section>
        <footer class="print-footer-signatures">
            <div class="print-signature-box"><p>Prepared By</p><div class="print-signature-line"></div></div>
            <div class="print-signature-box"><p>Reviewed By</p><div class="print-signature-line"></div></div>
            <div class="print-signature-box"><p>Approved By</p><div class="print-signature-line"></div></div>
        </footer>
    </div>

    <div id="ceo-receipt-template" style="position: absolute; left: -9999px; width: 320px; padding: 10px; border: 1px solid #ccc; background-color: #fff; font-family: 'Courier New', Courier, monospace; font-size: 14px; line-height: 1.5; box-sizing: border-box;">
        <h2 id="receipt-title" style="text-align: center; margin-top: 0; margin-bottom: 10px; font-size: 1.2rem;">Authorize Approval</h2>
        <p style="margin: 0;"><strong>Series #:</strong> <span id="receipt-series-no">IBA000</span></p>
        <p style="margin: 0;"><strong>Date:</strong> <span id="receipt-date">17/11/2025</span></p>
        <hr style="border: none; border-top: 1px dashed #999; margin: 10px 0;">
        <div id="approved-section">
            <h3 style="margin: 10px 0 5px 0; font-size: 1rem; border-bottom: 1px solid #999;">APPROVED</h3>
            <div id="receipt-approved-list" style="margin-bottom: 10px;"></div>
            <div class="total" style="font-weight: bold; border-top: 1px dashed #999; margin-top: 5px; padding-top: 5px; display: flex; justify-content: space-between;"><span>APPROVED TOTAL:</span><span id="receipt-approved-total">QR 0.00</span></div>
        </div>
        <div id="rejected-section" class="hidden">
            <h3 style="margin: 15px 0 5px 0; font-size: 1rem; border-bottom: 1px solid #999; color: #D32F2F;">REJECTED</h3>
            <div id="receipt-rejected-list" style="margin-bottom: 10px; color: #555;"></div>
            <div class="total" style="font-weight: bold; border-top: 1px dashed #999; margin-top: 5px; padding-top: 5px; display: flex; justify-content: space-between; color: #D32F2F;"><span>REJECTED TOTAL:</span><span id="receipt-rejected-total">QR 0.00</span></div>
        </div>
        <div id="receipt-footer" style="text-align: center; margin-top: 15px; padding-top: 10px; border-top: 1px dashed #999;">
    <p id="footer-esn" style="font-weight: bold; font-size: 0.9rem; margin: 5px 0;">ESN #: <span></span></p>
    
    <div id="receipt-qr-code" style="display: flex; justify-content: center; margin: 10px 0;"></div>
    <p id="footer-date" style="font-size: 0.8rem; margin: 5px 0;"></p>
</div>
    </div>

<div id="transfer-waybill-template" style="position: fixed; left: -9999px; top: 0; width: 800px; background: white; font-family: Arial, sans-serif; box-sizing: border-box; color: #000; border: 2px solid #000; padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; border-bottom: 3px solid #003A5C; padding-bottom: 10px;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="background-color: #003A5C; color: white; font-weight: 900; font-size: 36px; padding: 5px 15px; letter-spacing: 2px;">IBA</div>
            <div>
                <h2 id="wb-doc-title" style="margin: 0; font-size: 22px; text-transform: uppercase; font-weight: 800; color: #003A5C;">TRANSFER SLIP</h2>
                <p style="margin: 5px 0 0 0; font-size: 11px; color: #555;">Ismail Bin Ali Tradg. & Cont. Co. W.L.L</p>
            </div>
        </div>
        <div style="text-align: right;">
            <div id="wb-status-badge" style="border: 2px solid #000; padding: 5px 15px; font-weight: bold; font-size: 16px; display: inline-block; text-transform: uppercase;">PENDING</div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0; border: 2px solid #000;">
        <div style="border-right: 2px solid #000;">
            <div style="border-bottom: 2px solid #000; padding: 10px;">
                <div style="background-color: #003A5C; color: white; padding: 2px 5px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 5px;">1. FROM</div>
                <div style="margin-bottom: 8px;"><strong id="wb-from-site" style="font-size: 14px;">-</strong></div>
                <div><span style="font-size: 10px; color: #666;">By: </span><span id="wb-requestor" style="font-size: 12px;">-</span></div>
            </div>
            <div style="padding: 10px;">
                <div style="background-color: #003A5C; color: white; padding: 2px 5px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 5px;">2. TO</div>
                <div style="margin-bottom: 8px;"><strong id="wb-to-site" style="font-size: 14px;">-</strong></div>
                <div id="wb-receiver-container"><span style="font-size: 10px; color: #666;">Contact: </span><span id="wb-receiver" style="font-size: 12px;">-</span></div>
            </div>
        </div>

        <div>
            <div style="border-bottom: 2px solid #000; padding: 10px;">
                <div style="background-color: #003A5C; color: white; padding: 2px 5px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 5px;">3. DETAILS</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div><span style="font-size: 10px; color: #666;">Date</span><br><strong id="wb-date" style="font-size: 12px;">-</strong></div>
                    <div><span style="font-size: 10px; color: #666;">Control ID</span><br><strong id="wb-control-id" style="font-size: 12px;">-</strong></div>
                </div>
            </div>
            <div style="padding: 10px;">
                <div style="background-color: #003A5C; color: white; padding: 2px 5px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 10px;">4. APPROVAL</div>
                <div style="text-align: center;"> <img id="wb-barcode-approver" style="width: 100%; height: 45px; display: none; margin: 0 auto; object-fit: contain;">
                    <div id="wb-esn-text" style="font-size: 10px; font-family: monospace; font-weight: bold; margin-top: 2px;">PENDING APPROVAL</div>
                </div>
            </div>
        </div>
    </div>

    <div style="margin-top: 20px; border: 2px solid #000;">
        <div style="background-color: #ffc107; color: black; padding: 5px 10px; font-size: 12px; font-weight: bold; border-bottom: 2px solid #000;">5. ITEM DESCRIPTION</div>
        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
            <thead style="background: #f0f0f0;"><tr><th style="border-right:1px solid #000; padding:8px;">ID</th><th style="border-right:1px solid #000; padding:8px;">Name</th><th style="border-right:1px solid #000; padding:8px;">Details</th><th style="padding:8px;">Qty</th></tr></thead>
            <tbody><tr>
                <td id="wb-prod-id" style="border-right:1px solid #000; padding:10px; border-top:1px solid #000;">-</td>
                <td id="wb-prod-name" style="border-right:1px solid #000; padding:10px; border-top:1px solid #000; font-weight:bold;">-</td>
                <td id="wb-details" style="border-right:1px solid #000; padding:10px; border-top:1px solid #000;">-</td>
                <td id="wb-qty" style="padding:10px; border-top:1px solid #000; font-weight:bold; text-align:right;">0</td>
            </tr></tbody>
        </table>
    </div>

    <div style="margin-top: 30px; display: flex; gap: 20px; align-items: stretch;">

        <div style="flex: 1; border: 2px dashed #000; padding: 15px; text-align: center; border-radius: 8px;">
            <div style="font-size: 9px; font-weight: bold; color: #003A5C; margin-bottom: 10px; text-transform: uppercase;">FINAL VERIFICATION / RECEIPT</div>

            <img id="wb-barcode-receiver" style="width: 100%; height: 45px; display: none; margin: 0 auto; object-fit: contain;">

            <div id="wb-receiver-esn-container">
                <div id="wb-receiver-esn-text" style="font-size: 12px; font-weight: bold; font-family: monospace; margin-top: 5px;"></div>
            </div>

            <div id="wb-receiver-pending-text" style="font-size: 10px; color: #999; margin-top: 15px;">(Barcode generated upon completion)</div>
        </div>

        <div style="flex: 1; display: flex; flex-direction: column; justify-content: space-around;">
            <div>
                <div style="border-bottom: 1px solid #000; height: 20px;"></div>
                <div style="font-size: 10px; font-weight: bold; margin-top: 4px;">Approver Signature</div>
            </div>
            <div>
                <div style="border-bottom: 1px solid #000; height: 20px;"></div>
                <div style="font-size: 10px; font-weight: bold; margin-top: 4px;">Receiver Signature</div>
            </div>
        </div>

    </div>

    <div style="text-align: center; font-size: 9px; margin-top: 20px; color: #777;">Printed: <span id="wb-print-date"></span></div>
</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <script src="materialStock.js"></script>
    <script src="transferLogic.js"></script>
    <script src="app.js"></script>

    </body>
</html>
