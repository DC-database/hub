<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="app-container">
        <div id="login-view"><div class="form-container animated-card"><h2>System Login</h2><p>Please enter your email or mobile number to continue.</p><form id="login-form"><input type="text" id="login-identifier" placeholder="Email or Mobile Number" required><button type="submit">Continue</button></form><p id="login-error" class="error-message"></p></div></div>
        <div id="password-view" class="hidden"><div class="form-container animated-card"><h2>Enter Password</h2><p>Welcome back! Please enter your password for <strong id="password-user-identifier"></strong>.</p><form id="password-form"><input type="password" id="login-password" placeholder="Password" required><button type="submit">Login</button></form><p id="password-error" class="error-message"></p></div></div>
        
        <div id="setup-view" class="hidden"><div class="form-container animated-card"><h2>Complete Your Account Setup</h2><p>This is your first time logging in. Please complete the following steps.</p><form id="setup-form"><div id="setup-email-container" class="hidden"><label for="setup-email">Enter your email address:</label><input type="email" id="setup-email" placeholder="user@example.com" required></div><div id="setup-site-container" class="hidden"><label for="setup-site">Enter your Site:</label><input type="text" id="setup-site" placeholder="Site Name" required><p class="input-note">For multiple sites, separate them with a comma (ex. 175,176)</p></div><div id="setup-position-container" class="hidden"><label for="setup-position">Enter your Position:</label><input type="text" id="setup-position" placeholder="Position" required></div><label for="setup-password">Create Password</label><input type="password" id="setup-password" placeholder="New Password" required><button type="submit">Complete Setup</button></form><p id="setup-error" class="error-message"></p></div></div>
        
        <div id="dashboard-view" class="hidden">
            <div class="form-container animated-card">
                <header class="dashboard-header">
                    <div id="user-info">
                        <span id="dashboard-username"></span>
                        <span id="datetime"></span>
                    </div>
                    <button id="logout-button">Logout</button>
                </header>
                <main class="dashboard-main">
                    <div class="button-container">
                        <button id="workdesk-button" class="circle-button">WorkDesk</button>
                        <button id="invoice-mgmt-button" class="circle-button">Invoice Management</button>
                        <a href="https://ibaport.site/Finance/" target="_blank" class="circle-button hidden" id="finance-report-button">Finance Report</a>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <div id="workdesk-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile"><div class="wd-user-avatar"><i class="fa-solid fa-user"></i></div><h3 id="wd-username">User Name</h3><p id="wd-user-identifier">user@iba.com.qa</p></div>
            
            <a href="#" id="back-to-dashboard-button" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="workdesk-nav" class="workdesk-navigation">
                <ul>
                    <li><a href="#" data-section="wd-dashboard" class="active"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
                    <li><a href="#" data-section="wd-jobentry"><i class="fa-solid fa-file-pen"></i> Job Entry</a></li>
                    <li><a href="#" data-section="wd-activetask"><i class="fa-solid fa-list-check"></i> Active Task</a></li>
                    <li><a href="#" data-section="wd-taskhistory"><i class="fa-solid fa-clock-rotate-left"></i> Task History</a></li>
                    <li><a href="#" data-section="wd-reporting"><i class="fa-solid fa-chart-line"></i> Reporting</a></li>
                    </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li id="workdesk-im-link-container" class="hidden" style="margin-top: 20px; border-top: 1px solid #003366; padding-top: 10px;"><a href="#" id="workdesk-im-link"><i class="fa-solid fa-file-invoice-dollar"></i> Invoice Management</a></li>
                    <li><a href="#" data-section="wd-settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
                    <li><a href="#" id="wd-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>
        </aside>
        
        <main class="workdesk-main">
            <span id="workdesk-datetime"></span> 
            <div id="workdesk-content-area">
                
                <section id="wd-dashboard" class="workdesk-section">
                    <h1>Dashboard</h1>
                    
                    <div class="dashboard-summary-cards">
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #ffc107;"><i class="fa-solid fa-list-check"></i></div>
                            <div class="card-details">
                                <span id="db-active-tasks-count" class="card-value">0</span>
                                <span class="card-label">Total Active Tasks</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #28a745;"><i class="fa-solid fa-check-double"></i></div>
                            <div class="card-details">
                                <span id="db-completed-tasks-count" class="card-value">0</span>
                                <span class="card-label">Total Tasks Completed</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="wd-jobentry" class="workdesk-section hidden">
                    <h1 id="jobentry-form-title">Add New Job Entry</h1>
                    <form id="jobentry-form" class="jobentry-form-2col">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="job-for">Job</label>
                                <select id="job-for" name="for" required>
                                    <option value="" disabled selected>Select a Type</option>
                                    <option value="PR">PR</option>
                                    <option value="Invoice">Invoice</option>
                                    <option value="IPC">IPC</option>
                                    <option value="Payment">Payment</option>
                                    <option value="Transfer">Transfer</option>
                                    <option value="Trip">Trip</option>
                                    <option value="Report">Report</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="job-ref">Reference</label>
                                <input type="text" id="job-ref" name="ref">
                            </div>
                            <div class="form-group">
                                <label for="job-po">PO Number</label>
                                <input type="text" id="job-po" name="po" placeholder="PO Number">
                            </div>
                            <div class="form-group">
                                <label for="job-amount">Amount</label>
                                <input type="number" id="job-amount" name="amount" placeholder="0.00" step="0.01">
                            </div>
                        </div>

                        <div class="form-column">
                             <div class="form-group">
                                <label for="job-site">Site / Project No.</label>
                                <select id="job-site" name="site" required></select>
                            </div>
                            <div class="form-group">
                                <label for="job-group">Group</label>
                                <select id="job-group" name="group" required>
                                    <option value="" disabled selected>Select a Group</option>
                                    <option value="Civil">Civil</option>
                                    <option value="MEP">MEP</option>
                                    <option value="Logistic">Logistic</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                               <label for="job-attention">Attention</label>
                               <select id="job-attention" name="attention" required></select>
                            </div>
                             <div class="form-buttons-container">
                                <button type="button" id="add-job-button">Add</button>
                                <button type="button" id="update-job-button" class="hidden">Update</button>
                                <button type="button" id="clear-job-button" class="secondary-btn">Clear</button>
                            </div>
                        </div>
                         <div class="form-group hidden">
                            <label for="job-date">Date</label>
                            <input type="text" id="job-date" name="date" readonly>
                        </div>
                    </form>

                    <hr class="section-divider">

                    <div class="search-and-table-container">
                        <h2>Your Pending Job Entries</h2>
                        <div class="search-bar-local">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="job-entry-search" placeholder="Type to search your entries...">
                        </div>
                        <div id="job-entry-table-wrapper" class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job</th>
                                        <th>Ref</th>
                                        <th>PO</th>
                                        <th>Site</th>
                                        <th>Group</th>
                                        <th>Attention</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="job-entry-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <section id="wd-activetask" class="workdesk-section hidden">
                    <h1>Your Active Tasks</h1>
                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="active-task-search" placeholder="Type to search your active tasks...">
                    </div>
                     <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Job</th>
                                    <th>Ref</th>
                                    <th>PO</th>
                                    <th>Vendor Name</th>
                                    <th>Invoice Amount</th>
                                    <th>Site</th>
                                    <th>Group</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="active-task-table-body"></tbody>
                        </table>
                    </div>
                </section>

                 <section id="wd-taskhistory" class="workdesk-section hidden">
                    <h1>Task History</h1>
                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="task-history-search" placeholder="Type to search your task history...">
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Job</th>
                                    <th>Ref</th>
                                    <th>Amount</th>
                                    <th>PO</th>
                                    <th>Site</th>
                                    <th>Group</th>
                                    <th>Date Entered</th>
                                    <th>Date Responded</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="task-history-table-body"></tbody>
                        </table>
                    </div>
                </section>
                
                 <section id="wd-reporting" class="workdesk-section hidden">
                    <h1>Reporting - All Entries</h1>
                    
                    <div class="report-controls">
                        <div class="report-tabs-container">
                            <div id="report-tabs" class="report-tabs">
                                <button class="active" data-job-type="All">All Jobs</button>
                                <button data-job-type="PR">PR</button>
                                <button data-job-type="Invoice">Invoice</button>
                                <button data-job-type="IPC">IPC</button>
                                <button data-job-type="Payment">Payment</button>
                                <button data-job-type="Transfer">Transfer</button>
                                <button data-job-type="Trip">Trip</button>
                                <button data-job-type="Report">Report</button>
                            </div>
                        </div>
                        <div class="report-buttons-group">
                           <button id="print-report-button" class="print-btn"><i class="fa-solid fa-print"></i> Print Report</button>
                           <button id="download-wd-report-csv-button" class="download-btn"><i class="fa-solid fa-file-excel"></i> Save as Excel</button>
                        </div>
                    </div>

                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="reporting-search" placeholder="Type to search all system entries...">
                    </div>

                    <div id="reporting-printable-area">
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job</th>
                                        <th>Ref</th>
                                        <th>Site</th>
                                        <th>PO</th>
                                        <th>Vendor Name</th>
                                        <th>Amount</th>
                                        <th>Entered By</th>
                                        <th>Date Entered</th>
                                        <th>Attention</th>
                                        <th>Date Responded</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="reporting-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                 </section>

                 <section id="wd-settings" class="workdesk-section hidden">
                    <h1>Account Settings</h1>
                    <p>Manage your personal information and preferences. Fields that are greyed out are managed by the system administrator.</p>

                    <form id="settings-form">
                        <div class="jobentry-form-2col">
                            <div class="form-column">
                                <div class="form-group">
                                    <label for="settings-name">Name</label>
                                    <input type="text" id="settings-name" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="settings-email">Email</label>
                                    <input type="email" id="settings-email" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="settings-mobile">Mobile</label>
                                    <input type="text" id="settings-mobile" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="settings-position">Position</label>
                                    <input type="text" id="settings-position" readonly>
                                </div>
                            </div>
                            <div class="form-column">
                                <div class="form-group">
                                    <label for="settings-site">Site</label>
                                    <input type="text" id="settings-site" placeholder="Your site(s)">
                                    <p class="input-note">For multiple sites, separate them with a comma (ex. 175,176)</p>
                                </div>
                                <div class="form-group">
                                    <label for="settings-password">New Password</label>
                                    <input type="password" id="settings-password" placeholder="Leave blank to keep current password">
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="settings-vacation">
                                        <label for="settings-vacation">On Vacation</label>
                                    </div>
                                </div>
                                <div id="settings-vacation-details-container" class="hidden">
                                    <div class="form-group">
                                        <label for="settings-return-date">Return Date</label>
                                        <input type="date" id="settings-return-date">
                                    </div>
                                    <div class="form-group">
                                        <label for="settings-replacement-name">Replacement</label>
                                        <input type="text" id="settings-replacement-name" placeholder="Replacement's Name">
                                    </div>
                                    <div class="form-group">
                                        <label for="settings-replacement-contact">Replacement Contact No.</label>
                                        <input type="tel" id="settings-replacement-contact" placeholder="Replacement's Contact">
                                    </div>
                                    <div class="form-group">
                                        <label for="settings-replacement-email">Replacement Email</label>
                                        <input type="email" id="settings-replacement-email" placeholder="Replacement's Email">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-buttons-container" style="justify-content: flex-start; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                            <button type="submit" id="update-settings-button">Update Settings</button>
                        </div>
                        <p id="settings-message" class="error-message" style="text-align: left;"></p>
                    </form>
                </section>
            </div>
        </main>
    </div>

    <div id="invoice-management-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile">
                <div class="wd-user-avatar"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                <h3 id="im-username">User Name</h3>
                <p id="im-user-identifier">user@iba.com.qa</p>
            </div>
            
            <a href="#" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="im-nav" class="workdesk-navigation">
                <ul>
                    <li><a href="#" data-section="im-dashboard" class="active"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
                    <li><a href="#" data-section="im-invoice-entry"><i class="fa-solid fa-file-pen"></i> Invoice Entry</a></li>
                    <li><a href="#" id="batch-entry-nav-link" data-section="im-batch-entry"><i class="fa-solid fa-file-excel"></i> Batch Entry</a></li>
                    <li><a href="#" id="summary-note-nav-link" data-section="im-summary-note"><i class="fa-solid fa-receipt"></i> Summary Note</a></li>
                    <li><a href="#" data-section="im-reporting"><i class="fa-solid fa-chart-line"></i> Reporting</a></li>
                    
                    </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li id="im-nav-workdesk" class="hidden" style="margin-top: 20px; border-top: 1px solid #003366; padding-top: 10px;"><a href="#" id="im-workdesk-button"><i class="fa-solid fa-briefcase"></i> WorkDesk</a></li>
                    <li id="im-nav-activetask" class="hidden"><a href="#" id="im-activetask-button"><i class="fa-solid fa-list-check"></i> Active Task</a></li>
                    <li><a href="#" id="im-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>
        </aside>
        
        <main class="workdesk-main">
             <span id="im-datetime"></span> 
            <div id="im-content-area">
                
                <section id="im-dashboard" class="workdesk-section">
                    <h1>Dashboard</h1>
                    <p>Dashboard analytics view is currently unavailable.</p>
                </section>
                
                <section id="im-invoice-entry" class="workdesk-section hidden">
                    <h1>Invoice Entry</h1>
                    <div id="im-po-search-container">
                        <div class="search-bar-local">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="im-po-search-input" placeholder="Enter PO Number...">
                        </div>
                        <button id="im-po-search-button">Search PO</button>
                        <button id="im-refresh-entry-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i></button>
                    </div>

                    <div id="im-po-details-container" class="hidden">
                        <div class="po-details-grid">
                           <p><strong>PO No:</strong> <span id="im-po-no"></span></p>
                           <p><strong>Site:</strong> <span id="im-po-site"></span></p>
                           <p><strong>PO Value:</strong> <span id="im-po-value"></span></p>
                           <p><strong>Vendor:</strong> <span id="im-po-vendor"></span></p>
                        </div>
                    </div>
                    
                    <form id="im-new-invoice-form" class="hidden">
                        <hr class="section-divider">
                        <h2 id="im-form-title">Add New Invoice for this PO</h2>
                        <div class="jobentry-form-2col">
                            <div class="form-column">
                                <div class="form-group">
                                    <label>Invoice Entry ID</label>
                                    <input type="text" id="im-inv-entry-id" name="invEntryID">
                                </div>
                                <div class="form-group">
                                    <label for="im-inv-no">Invoice No.</label>
                                    <input type="text" id="im-inv-no" name="invNumber">
                                </div>
                                <div class="form-group">
                                    <label for="im-details">Details</label>
                                    <input type="text" id="im-details" name="details">
                                </div>
                                <div class="form-group">
                                    <label for="im-invoice-date">Invoice Date</label>
                                    <input type="date" id="im-invoice-date" name="invoiceDate">
                                </div>
                                <div class="form-group">
                                    <label for="im-inv-value">Invoice Value</label>
                                    <input type="number" id="im-inv-value" name="invValue" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="im-amount-paid">Amount To Paid</label>
                                    <input type="number" id="im-amount-paid" name="amountPaid" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="form-column">
                                <div class="form-group">
                                    <label for="im-inv-name">Invoice Name</label>
                                    <input type="text" id="im-inv-name" name="invName">
                                </div>
                                <div class="form-group">
                                    <label for="im-srv-name">SRV Name</label>
                                    <input type="text" id="im-srv-name" name="srvName">
                                </div>
                                <div class="form-group">
                                   <label for="im-attention">Attention</label>
                                   <select id="im-attention" name="attention"></select>
                                </div>
                                <div class="form-group">
                                    <label for="im-release-date">Release Date</label>
                                    <input type="date" id="im-release-date" name="releaseDate">
                                </div>
                                <div class="form-group">
                                    <label for="im-status">Status</label>
                                    <select id="im-status" name="status">
                                        <option value="For SRV">For SRV</option>
                                        <option value="Pending">Pending</option>
                                        <option value="For IPC">For IPC</option>
                                        <option value="Under Review">Under Review</option>
                                        <option value="CEO Approval">CEO Approval</option>
                                        <option value="Report">Report</option>
                                        <option value="With Accounts">With Accounts</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="im-note">Note</label>
                            <textarea id="im-note" name="note" rows="3" style="width: 100%; font: inherit; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-buttons-container">
                            <button type="button" id="im-add-invoice-button">Add Invoice</button>
                            <button type="button" id="im-update-invoice-button" class="hidden">Update Invoice</button>
                            <button type="button" id="im-clear-form-button" class="secondary-btn">Clear</button>
                            <button type="button" id="im-back-to-active-task-button" class="secondary-btn hidden">Back to Active Task</button>
                        </div>
                    </form>

                    <div id="im-existing-invoices-container" class="hidden">
                         <hr class="section-divider">
                        <h2>Existing Invoices for this PO</h2>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Inv Entry ID</th>
                                        <th>Inv No.</th>
                                        <th>Invoice Date</th>
                                        <th>Inv Value</th>
                                        <th>Amount To Paid</th>
                                        <th>Status</th>
                                        <th>Release Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="im-invoices-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="im-batch-entry" class="workdesk-section hidden">
                    <h1>Batch Invoice Entry</h1>
                    <p>Add a new PO for a new invoice, or search for a PO to add existing invoices for bulk editing.</p>
                    
                    <div id="im-batch-po-add-container" class="search-and-filter-group" style="margin-bottom: 20px;">
                        <input type="text" id="im-batch-po-input" placeholder="Enter PO, Status, or Note..." style="flex-grow: 1; margin-bottom: 0;">
                        <button id="im-batch-add-po-button" type="button">Add New PO</button>
                        <button id="im-batch-search-existing-button" type="button" class="secondary-btn">Search by PO</button>
                        <button id="im-batch-search-by-status-button" type="button" class="secondary-btn" style="background-color: #17a2b8;">Search by Status</button>
                        <button id="im-batch-search-by-note-button" type="button" class="secondary-btn" style="background-color: #ffc107; color: #212529;">Search by Note</button>
                    </div>

                    <div class="table-wrapper" style="max-height: 50vh; overflow-y: auto;">
                        <table id="im-batch-entry-table">
                            <thead>
                                <tr>
                                    <th>PO</th>
                                    <th>Site</th>
                                    <th>Vendor</th>
                                    <th>Inv. No.</th>
                                    <th>Details</th>
                                    <th>Inv. Date</th>
                                    <th>Inv. Value</th>
                                    <th>Amount To Paid</th>
                                    <th>Attention</th>
                                    <th>Status</th>
                                    <th>Note</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="im-batch-table-body">
                            </tbody>
                        </table>
                    </div>
                    <div class="form-buttons-container" style="justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <button id="im-refresh-batch-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i> Refresh Data</button>
                        <button id="im-batch-save-button" type="button" class="download-btn">Save All Invoices</button>
                    </div>
                </section>

                <section id="im-summary-note" class="workdesk-section hidden">
                    <h1>Summary Note Print</h1>
                    <div id="summary-note-controls">
                        <div class="form-group">
                            <label for="summary-note-previous-input">Previous Note</label>
                            <input type="text" id="summary-note-previous-input" list="note-suggestions" placeholder="e.g., 1st Payment">
                        </div>
                        <div class="form-group">
                            <label for="summary-note-current-input">Current Note</label>
                            <input type="text" id="summary-note-current-input" list="note-suggestions" placeholder="e.g., 2nd Payment">
                        </div>
                        
                        <div class="form-group">
                            <label for="summary-note-status-input">Set Status</label>
                            <select id="summary-note-status-input">
                                <option value="">(Keep Existing)</option>
                                <option value="For SRV">For SRV</option>
                                <option value="Pending">Pending</option>
                                <option value="For IPC">For IPC</option>
                                <option value="Under Review">Under Review</option>
                                <option value="CEO Approval">CEO Approval</option>
                                <option value="Report">Report</option>
                                <option value="With Accounts">With Accounts</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="summary-note-srv-input">Set SRV Name</label>
                            <input type="text" id="summary-note-srv-input" placeholder="Enter new SRV Name...">
                        </div>
                        <datalist id="note-suggestions"></datalist>
                        <div class="form-buttons-container" style="margin-top: 0; padding-top: 25px;">
                            <button type="button" id="im-refresh-summary-button" class="secondary-btn" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i></button>
                            <button type="button" id="summary-note-generate-btn">Generate Summary</button>
                            <button type="button" id="summary-note-update-btn" class="secondary-btn">Update Changes</button>
                            <button type="button" id="summary-note-print-btn" class="print-btn"><i class="fa-solid fa-print"></i> Print</button>
                        </div>
                    </div>
                    <hr class="section-divider">
                    <div id="summary-note-printable-area" class="hidden">
                        <div class="sn-header">
                            <span id="sn-date">Date: 14-October-2025</span>
                            <div class="sn-vendor-info">
                                <p><strong>Summary for :</strong> <span id="sn-vendor-name"></span></p>
                            </div>
                        </div>
                        <div class="sn-payment-details">
                            <div><strong>Previous Payment:</strong> <span id="sn-previous-payment"></span></div>
                            <div><strong>Current Payment:</strong> <span id="sn-current-payment"></span></div>
                        </div>
                        <table class="sn-table">
    <thead>
        <tr>
            <th>P.O.No.</th>
            <th>Site</th>
            <th>Bill Description</th>
            <th>Bill Date</th>
            <th>Payment Amount</th>
        </tr>
    </thead>
    <tbody id="sn-table-body">
    </tbody>
</table>
                        <div class="sn-footer">
                            <span>Total Current Payment</span>
                            <span id="sn-total-in-words"></span>
                            <span id="sn-total-numeric"></span>
                        </div>
                        <div class="sn-signatures">
                            <div>Prepared By</div>
                            <div>CEO</div>
                        </div>
                    </div>
                </section>

                <section id="im-reporting" class="workdesk-section hidden">
                    <div class="report-header">
                        <h1>Invoice Summary Report</h1>
                        <div class="daily-report-section">
                           <input type="date" id="im-daily-report-date" title="Select a date for the daily report">
                           <button id="im-download-daily-report-button" class="download-btn" type="button"><i class="fa-solid fa-calendar-day"></i> Daily Entry Report</button>
                           <button id="im-download-with-accounts-report-button" class="download-btn" type="button"><i class="fa-solid fa-file-invoice-dollar"></i> With Accounts Report</button>
                        </div>
                    </div>
                     <div class="reporting-legend">
                        <div class="legend-item"><span class="legend-color" style="background-color: #e0f7fa;"></span> Partially Paid</div>
                        <div class="legend-item"><span class="legend-color" style="background-color: #fff3e0;"></span> Fully Paid</div>
                    </div>
                    <form id="im-reporting-form" class="report-controls">
                        <div class="search-and-filter-group">
                            <div class="search-bar-local">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input type="text" id="im-reporting-search" placeholder="Search by PO or Vendor...">
                            </div>
                            <select id="im-reporting-site-filter" name="site-filter">
                                <option value="">All Sites</option>
                            </select>
                            <select id="im-reporting-status-filter" name="status-filter">
                                <option value="">All Statuses</option>
                                <option value="For SRV">For SRV</option>
                                <option value="Pending">Pending</option>
                                <option value="For IPC">For IPC</option>
                                <option value="Under Review">Under Review</option>
                                <option value="CEO Approval">CEO Approval</option>
                                <option value="Report">Report</option>
                                <option value="With Accounts">With Accounts</option>
                                <option value="On Hold">On Hold</option>
                                <option value="CLOSED">CLOSED</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                            <input type="month" id="im-reporting-date-filter" title="Filter by Release Month">
                        </div>
                        <div class="report-buttons-group">
                            <button type="submit">Search</button>
                            <button id="im-reporting-clear-button" class="secondary-btn" type="button">Clear</button>
                            <button id="im-refresh-reporting-button" class="secondary-btn" type="button" title="Refresh data from Firebase"><i class="fa-solid fa-sync"></i> Refresh Data</button>
                            <button id="im-reporting-download-csv-button" class="download-btn admin-accounting-only" type="button"><i class="fa-solid fa-download"></i> Download Full Report</button>
                        </div>
                    </form>
                    <div id="im-reporting-content" class="table-wrapper">
                        <p>Enter a search term and click Search to load data.</p>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <div id="vacation-replacement-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="vacation-modal-title">Attention: User on Vacation</h2>
                <button class="modal-close-btn" data-modal-id="vacation-replacement-modal">&times;</button>
            </div>
            <div class="modal-content">
                <p>The person you selected, <strong id="vacationing-user-name">User</strong>, is currently on vacation.</p>
                <p>They are scheduled to return on: <strong id="vacation-return-date">Date</strong>.</p>
                <p style="font-weight: bold; margin-top: 20px;">Please contact their designated replacement for this task:</p>
                <ul style="list-style: none; padding-left: 0; background-color: #f4f7fa; padding: 15px; border-radius: 4px;">
                    <li><strong>Name:</strong> <span id="replacement-name-display"></span></li>
                    <li><strong>Contact No:</strong> <span id="replacement-contact-display"></span></li>
                    <li><strong>Email:</strong> <span id="replacement-email-display"></span></li>
                </ul>
                <p style="margin-top: 20px;">You can close this window and select a different user, or proceed to contact the replacement.</p>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn modal-close-btn" data-modal-id="vacation-replacement-modal">Close</button>
            </div>
        </div>
    </div>

    <div id="im-batch-search-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Search and Add Existing Invoices</h2>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-content">
                <div class="search-and-filter-group" style="margin-bottom: 15px;">
                    <input type="text" id="im-batch-modal-po-input" placeholder="Enter PO to Search..." style="flex-grow: 1;">
                    <button id="im-batch-modal-search-btn">Search</button>
                </div>
                <div id="im-batch-modal-results" class="table-wrapper" style="max-height: 40vh; overflow-y: auto;">
                    <p>Enter a PO number to see existing invoices.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="im-batch-modal-add-selected-btn" class="download-btn">Add Selected to Batch</button>
                <button class="secondary-btn modal-close-btn">Cancel</button>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="app.js"></script>
</body>
</html>