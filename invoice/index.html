<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-container">
        <div id="login-view"><div class="form-container"><h2>System Login</h2><p>Please enter your email or mobile number to continue.</p><form id="login-form"><input type="text" id="login-identifier" placeholder="Email or Mobile Number" required><button type="submit">Continue</button></form><p id="login-error" class="error-message"></p></div></div>
        <div id="password-view" class="hidden"><div class="form-container"><h2>Enter Password</h2><p>Welcome back! Please enter your password for <strong id="password-user-identifier"></strong>.</p><form id="password-form"><input type="password" id="login-password" placeholder="Password" required><button type="submit">Login</button></form><p id="password-error" class="error-message"></p></div></div>
        <div id="setup-view" class="hidden"><div class="form-container"><h2>Complete Your Account Setup</h2><p>This is your first time logging in. Please complete the following steps.</p><form id="setup-form"><div id="setup-email-container" class="hidden"><label for="setup-email">Enter your email address:</label><input type="email" id="setup-email" placeholder="user@example.com" required></div><div id="setup-site-container" class="hidden"><label for="setup-site">Enter your Site:</label><input type="text" id="setup-site" placeholder="Site Name" required><p class="input-note">For multiple sites, separate them with a comma (ex. 175,176)</p></div><div id="setup-position-container" class="hidden"><label for="setup-position">Enter your Position:</label><input type="text" id="setup-position" placeholder="Position" required></div><label for="setup-password">Create Password</label><input type="password" id="setup-password" placeholder="New Password" required><button type="submit">Complete Setup</button></form><p id="setup-error" class="error-message"></p></div></div>
        
        <div id="dashboard-view" class="hidden">
            <div class="form-container">
                <header class="dashboard-header">
                    <div id="user-info">
                        <span id="dashboard-username"></span>
                        <span id="datetime"></span>
                    </div>
                    <button id="logout-button">Logout</button>
                </header>
                <main class="dashboard-main">
                    <div class="button-container">
                        <button id="workdesk-button" class="circle-button">WorkDesk</button>
                        <button id="invoice-mgmt-button" class="circle-button">Invoice Management</button>
                        <button class="circle-button">Accounts & Payments</button>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <div id="workdesk-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile"><div class="wd-user-avatar"><i class="fa-solid fa-user"></i></div><h3 id="wd-username">User Name</h3><p id="wd-user-identifier">user@iba.com.qa</p></div>
            
            <a href="#" id="back-to-dashboard-button" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="workdesk-nav" class="workdesk-navigation">
                <ul>
                    <li><a href="#" data-section="wd-dashboard" class="active"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
                    <li><a href="#" data-section="wd-jobentry"><i class="fa-solid fa-file-pen"></i> Job Entry</a></li>
                    <li><a href="#" data-section="wd-activetask"><i class="fa-solid fa-list-check"></i> Active Task</a></li>
                    <li><a href="#" data-section="wd-taskhistory"><i class="fa-solid fa-clock-rotate-left"></i> Task History</a></li>
                    <li><a href="#" data-section="wd-reporting"><i class="fa-solid fa-chart-line"></i> Reporting</a></li>
                </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li><a href="#" data-section="wd-settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
                    <li><a href="#" id="wd-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>
        </aside>
        
        <main class="workdesk-main">
            <span id="workdesk-datetime"></span> 
            <div id="workdesk-content-area">
                
                <section id="wd-dashboard" class="workdesk-section">
                    <h1>Dashboard</h1>
                    
                    <div class="dashboard-summary-cards">
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #ffc107;"><i class="fa-solid fa-list-check"></i></div>
                            <div class="card-details">
                                <span id="db-active-tasks-count" class="card-value">0</span>
                                <span class="card-label">Your Active Tasks</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #fd7e14;"><i class="fa-solid fa-file-pen"></i></div>
                            <div class="card-details">
                                <span id="db-pending-entries-count" class="card-value">0</span>
                                <span class="card-label">Your Pending Entries</span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon" style="background-color: #28a745;"><i class="fa-solid fa-check-double"></i></div>
                            <div class="card-details">
                                <span id="db-completed-tasks-count" class="card-value">0</span>
                                <span class="card-label">Your Completed Tasks</span>
                            </div>
                        </div>
                    </div>

                    <hr class="section-divider">

                    <h2>Site Performance</h2>
                    <div id="dashboard-site-stats">
                        <p>Loading site data...</p>
                    </div>

                    <hr class="section-divider">
                    
                    <h2>Recent Active Tasks</h2>
                    <div class="table-wrapper">
                        <table id="dashboard-recent-tasks">
                            <thead>
                                <tr>
                                    <th>Job</th>
                                    <th>Ref</th>
                                    <th>Site</th>
                                    <th>Entered By</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="db-recent-tasks-body">
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <section id="wd-jobentry" class="workdesk-section hidden">
                    <h1 id="jobentry-form-title">Add New Job Entry</h1>
                    <form id="jobentry-form" class="jobentry-form-2col">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="job-for">Job</label>
                                <select id="job-for" name="for" required>
                                    <option value="" disabled selected>Select a Type</option>
                                    <option value="PR">PR</option>
                                    <option value="Invoice">Invoice</option>
                                    <option value="IPC">IPC</option>
                                    <option value="Payment">Payment</option>
                                    <option value="Transfer">Transfer</option>
                                    <option value="Trip">Trip</option>
                                    <option value="Report">Report</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="job-ref">Reference</label>
                                <input type="text" id="job-ref" name="ref">
                            </div>
                            <div class="form-group">
                                <label for="job-po">PO Number</label>
                                <input type="text" id="job-po" name="po" placeholder="PO Number">
                            </div>
                            <div class="form-group">
                                <label for="job-amount">Amount</label>
                                <input type="number" id="job-amount" name="amount" placeholder="0.00" step="0.01">
                            </div>
                        </div>

                        <div class="form-column">
                             <div class="form-group">
                                <label for="job-site">Site / Project No.</label>
                                <select id="job-site" name="site" required></select>
                            </div>
                            <div class="form-group">
                                <label for="job-group">Group</label>
                                <select id="job-group" name="group" required>
                                    <option value="" disabled selected>Select a Group</option>
                                    <option value="Civil">Civil</option>
                                    <option value="MEP">MEP</option>
                                    <option value="Logistic">Logistic</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                               <label for="job-attention">Attention</label>
                               <select id="job-attention" name="attention" required></select>
                            </div>
                             <div class="form-buttons-container">
                                <button type="button" id="add-job-button">Add</button>
                                <button type="button" id="update-job-button" class="hidden">Update</button>
                                <button type="button" id="clear-job-button" class="secondary-btn">Clear</button>
                            </div>
                        </div>
                         <div class="form-group hidden">
                            <label for="job-date">Date</label>
                            <input type="text" id="job-date" name="date" readonly>
                        </div>
                    </form>

                    <hr class="section-divider">

                    <div class="search-and-table-container">
                        <h2>Your Pending Job Entries</h2>
                        <div class="search-bar-local">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="job-entry-search" placeholder="Type to search your entries...">
                        </div>
                        <div id="job-entry-table-wrapper" class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job</th>
                                        <th>Ref</th>
                                        <th>PO</th>
                                        <th>Site</th>
                                        <th>Group</th>
                                        <th>Attention</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="job-entry-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
                
                <section id="wd-activetask" class="workdesk-section hidden">
                    <h1>Your Active Tasks</h1>
                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="active-task-search" placeholder="Type to search your active tasks...">
                    </div>
                     <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Job</th>
                                    <th>Ref</th>
                                    <th>PO</th>
                                    <th>Site</th>
                                    <th>Group</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="active-task-table-body"></tbody>
                        </table>
                    </div>
                </section>

                 <section id="wd-taskhistory" class="workdesk-section hidden">
                    <h1>Task History</h1>
                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="task-history-search" placeholder="Type to search your task history...">
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Job</th>
                                    <th>Ref</th>
                                    <th>Amount</th>
                                    <th>PO</th>
                                    <th>Site</th>
                                    <th>Group</th>
                                    <th>Date Entered</th>
                                    <th>Date Responded</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="task-history-table-body"></tbody>
                        </table>
                    </div>
                </section>
                
                 <section id="wd-reporting" class="workdesk-section hidden">
                    <h1>Reporting - All Entries</h1>
                    
                    <div class="report-controls">
                        <div class="report-tabs-container">
                            <div id="report-tabs" class="report-tabs">
                                <button class="active" data-job-type="All">All Jobs</button>
                                <button data-job-type="PR">PR</button>
                                <button data-job-type="Invoice">Invoice</button>
                                <button data-job-type="IPC">IPC</button>
                                <button data-job-type="Payment">Payment</button>
                                <button data-job-type="Transfer">Transfer</button>
                                <button data-job-type="Trip">Trip</button>
                                <button data-job-type="Report">Report</button>
                            </div>
                        </div>
                        <div class="report-buttons-group">
                           <button id="print-report-button" class="print-btn"><i class="fa-solid fa-print"></i> Print Report</button>
                           <button id="download-wd-report-csv-button" class="download-btn"><i class="fa-solid fa-file-excel"></i> Save as Excel</button>
                        </div>
                    </div>

                    <div class="search-bar-local">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <input type="text" id="reporting-search" placeholder="Type to search all system entries...">
                    </div>

                    <div id="reporting-printable-area">
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Job</th>
                                        <th>Ref</th>
                                        <th>PO</th>
                                        <th>Amount</th>
                                        <th>Site</th>
                                        <th>Attention</th>
                                        <th>Entered By</th>
                                        <th>Date Entered</th>
                                        <th>Date Responded</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="reporting-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                 </section>

                 <section id="wd-settings" class="workdesk-section hidden"><h1>Settings</h1><p>This area is under construction.</p></section>
            </div>
        </main>
    </div>

    <div id="invoice-management-view" class="hidden">
        <aside class="workdesk-sidebar">
            <div class="wd-user-profile">
                <div class="wd-user-avatar"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                <h3 id="im-username">User Name</h3>
                <p id="im-user-identifier">user@iba.com.qa</p>
            </div>
            
            <a href="#" class="wd-back-button back-to-main-dashboard"><i class="fa-solid fa-arrow-left"></i> Welcome Screen</a>

            <nav id="im-nav" class="workdesk-navigation">
                <ul>
                    <li><a href="#" data-section="im-dashboard" class="active"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
                    <li><a href="#" data-section="im-invoice-entry"><i class="fa-solid fa-file-pen"></i> Invoice Entry</a></li>
                    <li><a href="#" data-section="im-reporting"><i class="fa-solid fa-chart-line"></i> Reporting</a></li>
                </ul>
            </nav>
            <div class="workdesk-footer-nav">
                 <ul>
                    <li><a href="#" id="im-logout-button"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                </ul>
            </div>
        </aside>
        
        <main class="workdesk-main">
             <span id="im-datetime"></span> 
            <div id="im-content-area">
                
                <section id="im-dashboard" class="workdesk-section">
                    <h1>Invoice Dashboard</h1>
                    <p>Dashboard content for invoices will be built here.</p>
                </section>
                
                <section id="im-invoice-entry" class="workdesk-section hidden">
                    <h1>Invoice Entry</h1>
                    <div id="im-po-search-container">
                        <div class="search-bar-local">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <input type="text" id="im-po-search-input" placeholder="Enter PO Number...">
                        </div>
                        <button id="im-po-search-button">Search PO</button>
                    </div>

                    <div id="im-po-details-container" class="hidden">
                        <div class="po-details-grid">
                           <p><strong>PO No:</strong> <span id="im-po-no"></span></p>
                           <p><strong>Site:</strong> <span id="im-po-site"></span></p>
                           <p><strong>PO Value:</strong> <span id="im-po-value"></span></p>
                           <p><strong>Vendor:</strong> <span id="im-po-vendor"></span></p>
                        </div>
                    </div>
                    
                    <form id="im-new-invoice-form" class="hidden">
                        <hr class="section-divider">
                        <h2 id="im-form-title">Add New Invoice for this PO</h2>
                        <div class="jobentry-form-2col">
                            <div class="form-column">
                                <div class="form-group">
                                    <label>Invoice Entry ID</label>
                                    <input type="text" id="im-inv-entry-id" name="invEntryID" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="im-inv-no">Invoice No.</label>
                                    <input type="text" id="im-inv-no" name="invNumber">
                                </div>
                                <div class="form-group">
                                    <label for="im-invoice-date">Invoice Date</label>
                                    <input type="date" id="im-invoice-date" name="invoiceDate">
                                </div>
                                <div class="form-group">
                                    <label for="im-inv-value">Invoice Value</label>
                                    <input type="number" id="im-inv-value" name="invValue" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="im-amount-paid">Amount Paid</label>
                                    <input type="number" id="im-amount-paid" name="amountPaid" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="form-column">
                                <div class="form-group">
                                    <label for="im-inv-name">Invoice Name / Description</label>
                                    <input type="text" id="im-inv-name" name="invName">
                                </div>
                                <div class="form-group">
                                    <label for="im-srv-name">SRV Name</label>
                                    <input type="text" id="im-srv-name" name="srvName">
                                </div>
                                <div class="form-group">
                                   <label for="im-attention">Attention</label>
                                   <select id="im-attention" name="attention"></select>
                                </div>
                                <div class="form-group">
                                    <label for="im-release-date">Release Date</label>
                                    <input type="date" id="im-release-date" name="releaseDate">
                                </div>
                                <div class="form-group">
                                    <label for="im-status">Status</label>
                                    <select id="im-status" name="status">
                                        <option value="For SRV">For SRV</option>
                                        <option value="Pending">Pending</option>
                                        <option value="For IPC">For IPC</option>
                                        <option value="Under Review">Under Review</option>
                                        <option value="CEO Approval">CEO Approval</option>
                                        <option value="With Accounts">With Accounts</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px;">
                            <label for="im-note">Note</label>
                            <textarea id="im-note" name="note" rows="3" style="width: 100%; font: inherit; padding: 10px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-buttons-container">
                            <button type="button" id="im-add-invoice-button">Add Invoice</button>
                            <button type="button" id="im-update-invoice-button" class="hidden">Update Invoice</button>
                            <button type="button" id="im-clear-form-button" class="secondary-btn">Clear</button>
                        </div>
                    </form>

                    <div id="im-existing-invoices-container" class="hidden">
                         <hr class="section-divider">
                        <h2>Existing Invoices for this PO</h2>
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Inv Entry ID</th>
                                        <th>Inv No.</th>
                                        <th>Invoice Date</th>
                                        <th>Inv Value</th>
                                        <th>Amount Paid</th>
                                        <th>Status</th>
                                        <th>Release Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="im-invoices-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="im-reporting" class="workdesk-section hidden">
                    <h1>Invoice Report</h1>
                    <form id="im-reporting-form" class="report-controls">
                        <div class="search-and-filter-group">
                            <div class="search-bar-local">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input type="text" id="im-reporting-search" placeholder="Search by PO, Site, or Vendor...">
                            </div>
                            <select id="im-reporting-filter-column" title="Filter by Column">
                                <option value="none">No Filter</option>
                                <option value="invoiceDate">Invoice Date</option>
                                <option value="releaseDate">Release Date</option>
                                <option value="status">Status</option>
                            </select>
                            <select id="im-reporting-filter-condition" title="Filter Condition">
                                <option value="is-not-empty">Is Not Empty</option>
                                <option value="is-empty">Is Empty</option>
                            </select>
                        </div>
                        <div class="report-buttons-group">
                            <button type="submit">Search</button>
                            <button id="im-reporting-clear-button" class="secondary-btn" type="button">Clear</button>
                            <button id="im-reporting-download-csv-button" class="download-btn" type="button"><i class="fa-solid fa-download"></i> Download CSV</button>
                        </div>
                    </form>
                    <div id="im-reporting-content" class="table-wrapper">
                        <p>Click Search to load all data, or enter a term to narrow your results.</p>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="app.js"></script>
</body>
</html>